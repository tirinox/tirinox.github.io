(function(){"use strict";var e={2918:function(e,t,s){var n=s(9242),i=s(3396);function o(e,t,s,n,o,r){const a=(0,i.up)("MainScreen");return(0,i.wg)(),(0,i.j4)(a)}const r={class:"container"},a={class:"canvas-container"},c={class:"ui-container"};function l(e,t,s,o,l,h){const d=(0,i.up)("FPSCounter"),u=(0,i.up)("LoadingIndicator"),m=(0,i.up)("ControlPanel"),p=(0,i.up)("NewVersionPanel"),v=(0,i.up)("NodeDetailsWindow");return(0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",a,[(0,i._)("canvas",{ref:"canvas",class:"canvas-full",tabindex:"1",onKeypress:t[0]||(t[0]=(0,n.iM)(((...e)=>h.onKeyDown&&h.onKeyDown(...e)),["prevent"])),onMousemove:t[1]||(t[1]=(...e)=>h.onMouseMove&&h.onMouseMove(...e)),onMouseenter:t[2]||(t[2]=(...e)=>h.onMouseEnter&&h.onMouseEnter(...e)),onMouseleave:t[3]||(t[3]=(...e)=>h.onMouseLeave&&h.onMouseLeave(...e)),onClick:t[4]||(t[4]=(0,n.iM)(((...e)=>h.onClick&&h.onClick(...e)),["prevent"]))},null,544),(0,i.wy)((0,i.Wm)(d,{ref:"fps"},null,512),[[n.F8,l.showFps]]),l.isLoading?((0,i.wg)(),(0,i.j4)(u,{key:0})):(0,i.kq)("",!0),l.fullyLoaded?((0,i.wg)(),(0,i.j4)(m,{key:1,onModeSelected:h.setSceneMode},null,8,["onModeSelected"])):(0,i.kq)("",!0),l.version.newDetected?((0,i.wg)(),(0,i.j4)(p,{key:2,"old-version":l.version.oldVersion,"new-version":l.version.newVersion},null,8,["old-version","new-version"])):(0,i.kq)("",!0)]),(0,i._)("div",c,[((0,i.wg)(),(0,i.j4)(i.Ob,null,[l.nodeDetailsVisible?((0,i.wg)(),(0,i.j4)(v,{key:0,node:l.nodeToViewDetails,"node-set":l.nodeSet,"is-left":l.nodeDetailsIsLeft,onClose:h.onCloseDetails},null,8,["node","node-set","is-left","onClose"])):(0,i.kq)("",!0)],1024))])])}var h=s(1114);const d=!0;console.log("Env = ","production");const u={DataSource:{THORNodeURL:"https://thornode.ninerealms.com",MidgardURL:"https://midgard.ninerealms.com",Nodes:{PollPeriod:3e3},LastBlock:{PollPeriod:1e4},Network:{PollPeriod:6e4},ReactRandomDelay:500,NodeJuggler:{Enabled:!1}},Font:{Main:"fonts/Exo2-VariableFont_wght.ttf"},Effects:{Bloom:{Enabled:!0,Strength:.65,Threshold:.5,Radius:1.2}},Controls:{Camera:{Distance:{Min:800,Max:2900,Start:2e3},AzimuthAngleLimit:180,PolarAngleLimit:180,MouseMoveStrength:2e-4,Animation:{Duration:500,DistanceWhenZoomed:300,Shift:{X:-200}}}},Scene:{DebugMode:!1,InitialMode:d?"normal":"bond",Background:{Enabled:d},Sky:{SkyBox:"texture/skybox/star",SkyBoxExt:"png"},NodeObject:{Simple:!1,PlaneScale:1,MinRadius:12,MaxScale:80,MinScale:10,ScaleFactor:1,RadiusFactor:.3,Animation:{ReactStatus:{DurationIn:500,DurationOut:1250,BloatScale:1.5},ReactSlash:{Force:100,RedDuration:150}},Rust:{MaxLagToFullRust:172800,MaxStrength:.85}},Globe:{Enabled:!0,Details:64,Radius:600,NodeElevation:20,TextureMap:"texture/globe/2k_earth_nightmap.jpeg",Clouds:{ElevationScale:1.005,Opacity:.05,Texture:"texture/globe/earth_atmo.jpeg"},Atmosphere:{ElevationScale:1.15},InnerAtmosphere:{Enabled:!0}}},Physics:{BaseForce:3500,RepelForce:200,Startup:{SimulationSteps:10,DeltaTime:.1},BaseFriction:.07,HoverFriction:.3,MaxSpeedSq:Math.pow(15e3,2),Attractor:{Flat:{DeltaZ:1}}},Debug:{ShowFPS:!1},Renderer:{LogZBuffer:!0},SoftwareVersion:{Enabled:!0,Interval:6e4}},m={LightningBlue:52479,YggdrasilGreen:3407769,MidgardTurqoise:2350280,NightBlack:1055009};var p=s(2071),v=s(2338),f=s(9868),g=s(7139);const y={class:"fps-counter"},x={class:"activity"};function w(e,t,s,o,r,a){return(0,i.wg)(),(0,i.iD)("div",y,[(0,i._)("span",null,[(0,i._)("strong",null,(0,g.zw)(Number(r.fps).toFixed(2)),1),(0,i.Uk)(" FPS, "+(0,g.zw)(r.objCount)+" objects",1)]),(0,i.wy)((0,i._)("span",x,"â€¢",512),[[n.F8,r.activityIndicator]])])}function _(e){let t=0;return e.traverse((function(){t++})),t}function b(e){e&&e.remove.apply(e,e.children)}function S(e,t,s=1){const n=Math.PI*(.5-t/180),i=Math.PI*(.5+e/180),o=new h.Spherical(s,n,i);return(new h.Vector3).setFromSpherical(o)}function P(e,t){const s=e.x-t.x,n=e.y-t.y;return Math.sqrt(s*s+n*n)}var T=s(1373);const C={FullyLoaded:"fully_loaded",DataSourceTick:"data_source_tick",Activity:"activity",NewViewerVersion:"new_viewer_version",NodeChurnUpdate:"node_churn_update"},N=(0,T.Z)();function k(e,t=1e3){setTimeout((()=>{N.emit(e)}),t)}function M(){k(C.FullyLoaded,100)}var D={name:"FPSCounter",props:{updatePeriod:{type:Number,default:1}},data(){return{fps:0,objCount:0,activityIndicator:!1,lastUpdateTime:0}},methods:{pokeActivity(){this.activityIndicator=!0,setTimeout((()=>{this.activityIndicator=!1}),100)},update(e,t){e>0&&+Date.now()-1e3*this.updatePeriod>this.lastUpdateTime&&(this.fps=1/e,this.objCount=_(t),this.lastUpdateTime=+Date.now())}},unmounted(){N.off(C.Activity,this.pokeActivity)},mounted(){N.on(C.Activity,this.pokeActivity)}},A=s(89);const V=(0,A.Z)(D,[["render",w],["__scopeId","data-v-27eb1626"]]);var E=V,O=(s(7658),s(4806)),I=s.n(O),z=s(9172),F=s.n(z);function R(e,t){return void 0===e?t:e}function B(e){return e.toString(16).padStart(2,"0")}class j{static getRandomInt(e){return Math.floor(Math.random()*e)}static getRandomFloat(e,t){return Math.random()*(t-e)+e}static getRandomSample(e){if(!e)return null;const t=j.getRandomInt(e.length);return e[t]}static removeRandomItem(e){if(Math.random()>.5){const t=j.getRandomInt(e.length);e.splice(t,1)}return e}static randomVector({xMin:e,xMax:t,yMin:s,yMax:n,zMin:i,zMax:o}){return e=R(+e,-10),t=R(+t,10),s=R(+s,-10),n=R(+n,10),i=R(+i,-10),o=R(+o,10),new h.Vector3(j.getRandomFloat(e,t),j.getRandomFloat(s,n),j.getRandomFloat(i,o))}static randomOnCircle(e=100,t=0,s=0){const n=j.getRandomFloat(0,2*Math.PI);return new h.Vector3(t+e*Math.cos(n),s+e*Math.sin(n))}static getRandomIntRange(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}static generateId(e){const t=new Uint8Array((e||20)/2);return window.crypto.getRandomValues(t),Array.from(t,B).join("")}}class L{constructor(e,t){this.p1=e,this.p2=t}get dx(){return this.p2.x-this.p1.x}get dy(){return this.p2.y-this.p1.y}whichSide(e,t){const s=e-this.p1.x,n=t-this.p1.y,i=this.dx,o=this.dy;return Math.sign(s*i-n*o)}get center(){return{x:.5*(this.p1.x+this.p2.x),y:.5*(this.p1.y+this.p2.y)}}nearestPoint(e,t){const s=e-this.p1.x,n=t-this.p1.y,i=this.dx,o=this.dy,r=s*i+n*o,a=i*i+o*o;let c=-1;return 0!==a&&(c=r/a),c<0?(e=this.p1.x,t=this.p1.y):c>1?(e=this.p2.x,t=this.p2.y):(e=this.p1.x+c*i,t=this.p1.y+c*o),{x:e,y:t}}pDistance(e,t){const s=this.nearestPoint(e,t);return new L(s,{x:e,y:t}).length}get length(){const e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}}class U{static clamp(e,t,s){return Math.min(+s,Math.max(+t,+e))}static centerOf(e){if(!e||!e.length)return;let t=I().sumBy(e,(e=>e.x)),s=I().sumBy(e,(e=>e.y));return{x:t/e.length,y:s/e.length}}static _signHelper(e,t,s){return(e.x-s.x)*(t.y-s.y)-(t.x-s.x)*(e.y-s.y)}static pointInTriangle(e,t){const[s,n,i]=t,o=U._signHelper(e,s,n),r=U._signHelper(e,n,i),a=U._signHelper(e,i,s),c=o<0||r<0||a<0,l=o>0||r>0||a>0;return!(c&&l)}}function H(e,t=2,s=""){return F()(e).format({average:!0,mantissa:t})+s}const G="Rune";function q(e,t=2){return H(e,t," "+G)}function W(e,t,s){var n=Math.max(0,Math.min(1,(s-e)/(t-e)));return n*n*(3-2*n)}var $=s(2378);class Y{constructor(){this.mass=1,this.force=new h.Vector3,this.velocity=new h.Vector3,this.friction=0,this.attractors=[]}update(e){this.attractors.forEach?this.attractors.forEach((e=>e.applyForce(this))):this.attractors.applyForce&&this.attractors.applyForce(this);const t=this.force.multiplyScalar(this.mass);this.velocity.copy(this.velocity.clone().add(t.multiplyScalar(e))),this.velocity.multiplyScalar(U.clamp(1-this.friction,0,1)),this.velocity.lengthSq()>u.Physics.MaxSpeedSq&&this.velocity.setLength(Math.sqrt(u.Physics.MaxSpeedSq)),this.realObject.position.add(this.velocity.clone().multiplyScalar(e))}nullifyForce(){this.force.set(0,0,0)}get radius(){return 1}applyForceTo(e,t){this.force.add(e.copy().multiplyScalar(t))}get realObject(){return this}repel(e,t=100){if(e===this)return;const s=this.realObject.position,n=e.realObject.position,i=s.distanceTo(n),o=this.radius+e.radius;if(i<o){const i=s.clone().sub(n).normalize().multiplyScalar(t);this.force.add(i),e.force.add(i.negate())}}get boundingBox(){const e=this.realObject.position.x,t=this.realObject.position.y,s=this.radius;return{minX:e-s,minY:t-s,maxX:e+s,maxY:t+s}}shootOut(e=1){const t=this.o.position.clone().normalize().multiplyScalar(e);this.velocity.copy(t)}}var X="#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\nvarying float vIsPerspective;\n#else\nuniform float logDepthBufFC;\n#endif\n#endif\n\n// optional: pass 2D rotation angle as an uniform\nuniform float rotation;\n// optional: pass 2D center point as an uniform\nuniform vec2 center;\n\nvarying vec2 vUv;\n\n// optional: use this define to scale the model according to distance from the camera\n#define USE_SIZEATTENUATION\n\n// [skipped includes]\n\nvoid main() {\n    vUv = uv;\n\n    // discard rotation and scale\n    vec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n\n    // extract model's scale\n    vec2 scale;\n    scale.x = length(vec3(modelMatrix[0].x, modelMatrix[0].y, modelMatrix[0].z));\n    scale.y = length(vec3(modelMatrix[1].x, modelMatrix[1].y, modelMatrix[1].z));\n\n    // if not defined, keep model the same size regardless of distance from the camera\n    #ifndef USE_SIZEATTENUATION\n    bool isPerspective = isPerspectiveMatrix(projectionMatrix);\n    if (isPerspective) scale *= - mvPosition.z;\n    #endif\n\n    // if center is not passed as uniform, create vec2 center = vec2(0.0);\n\n    // aligned with the camera [and scaled]\n    vec2 alignedPosition = (position.xy - center) * scale;\n\n    // if rotation is not passed as uniform, skip the next block\n\n    // rotate 2D\n    vec2 rotatedPosition;\n    rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n    rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n\n    // billboard\n    mvPosition.xy += rotatedPosition;\n\n    gl_Position = projectionMatrix * mvPosition;\n\n    // [skipped includes]\n    #ifdef USE_LOGDEPTHBUF\n        #ifdef USE_LOGDEPTHBUF_EXT\n    vFragDepth = 1.0 + gl_Position.w;\n//    vIsPerspective = float(isPerspectiveMatrix(projectionMatrix));\n    vIsPerspective = 1.0;\n        #else\n//    if (isPerspectiveMatrix(projectionMatrix)) {\n        gl_Position.z = log2(max(EPSILON, gl_Position.w + 1.0)) * logDepthBufFC - 1.0;\n        gl_Position.z *= gl_Position.w;\n//    }\n        #endif\n    #endif\n}",K="// port from http://glslsandbox.com/e#8625.0 by Duke\n// Fireball\n// Awd\n// @AlexWDunn\n\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\nuniform float logDepthBufFC;\nvarying float vFragDepth;\nvarying float vIsPerspective;\n#endif\n\nuniform float time;\n\nuniform float saturation;\nuniform float transitionShininess;\nuniform float rust;\n\nuniform vec3 color;\n\nvarying vec2 vUv;\n\n#define saturate(oo) clamp(oo, 0.0, 1.0)\n\n// Quality Settings\n#define MarchSteps 4\n// Scene Settings\n#define ExpPosition vec3(0.0)\n#define Radius 1.0\n#define Background vec4(0.0, 0.0, 0.0, 0.0)\n// Noise Settings\n#define NoiseSteps 1\n#define NoiseAmplitude 0.06\n//#define NoiseFrequency 4.0\n#define NoiseFrequency 2.0\n#define Animation vec3(0.0, -3.0, 0.5)\n\n// Colour Gradient\n#define Color1 vec4(1.0, 1.0, 1.0, 1.0)\n#define Color2 vec4(0.2, 0.8, 1.0, 1.0)\n#define Color3 vec4(0.2, 0.03, 1.0, 1.0)\n#define Color4 vec4(0.05, 0.02, 0.02, 0.3)\n\nconst float zoom = 2.8f;// 2.5 full\n\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n//\nvec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\nvec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }\nvec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }\n\nfloat snoise(vec3 v)\n{\n    const vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);\n    const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);\n    // First corner\n    vec3 i = floor(v + dot(v, C.yyy));\n    vec3 x0 = v - i + dot(i, C.xxx);\n    // Other corners\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min(g.xyz, l.zxy);\n    vec3 i2 = max(g.xyz, l.zxy);\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy;// 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;// -1.0+3.0*C.x = -0.5 = -D.y\n    // Permutations\n    i = mod289(i);\n    vec4 p = permute(permute(permute(i.z + vec4(0.0, i1.z, i2.z, 1.0)) + i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));\n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857;// 1.0/7.0\n    vec3 ns = n_ * D.wyz - D.xzx;\n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);//  mod(p,7*7)\n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_);// mod(j,N)\n    vec4 x = x_ * ns.x + ns.yyyy;\n    vec4 y = y_ * ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    vec4 b0 = vec4(x.xy, y.xy);\n    vec4 b1 = vec4(x.zw, y.zw);\n    vec4 s0 = floor(b0) * 2.0 + 1.0;\n    vec4 s1 = floor(b1) * 2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;\n    vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;\n    vec3 p0 = vec3(a0.xy, h.x);\n    vec3 p1 = vec3(a0.zw, h.y);\n    vec3 p2 = vec3(a1.xy, h.z);\n    vec3 p3 = vec3(a1.zw, h.w);\n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot(m * m, vec4(dot(p0, x0), dot(p1, x1), dot(p2, x2), dot(p3, x3)));\n}\n\n\n\nfloat Turbulence(vec3 position, float minFreq, float maxFreq, float qWidth)\n{\n    float value = 0.0;\n    float cutoff = clamp(0.5 / qWidth, 0.0, maxFreq);\n    float fade;\n    float fOut = minFreq;\n    for (int i = NoiseSteps; i >= 0; i--)\n    {\n        if (fOut >= 0.5 * cutoff) break;\n        fOut *= 2.0;\n        value += abs(snoise(position * fOut)) / fOut;\n    }\n    fade = clamp(2.0 * (cutoff - fOut) / cutoff, 0.0, 1.0);\n    value += fade * abs(snoise(position * fOut)) / fOut;\n    return 1.0 - value;\n}\n\nfloat SphereDist(vec3 position)\n{\n    return length(position - ExpPosition) - Radius;\n}\n\nvec4 Shade(float distance)\n{\n    float c1 = clamp(distance * 5.0 + 0.5, 0.0, 1.0);\n    float c2 = clamp(distance * 5.0, 0.0, 1.0);\n    float c3 = clamp(distance * 3.4 - 0.5, 0.0, 1.0);\n\n    //    #define Color1 vec4(1.0, 1.0, 1.0, 1.0)   -- white\n    //    #define Color2 vec4(0.2, 0.8, 1.0, 1.0) --- green\n    //    #define Color3 vec4(0.2, 0.03, 1.0, 1.0)  -- blue\n    //    #define Color4 vec4(0.05, 0.02, 0.02, 0.3) -- black transparent\n\n    vec4 original = vec4(color, 1.0);\n    vec4 a = mix(Color1, Color3, c1);\n    vec4 b = mix(a, Color4, c2);\n    return mix(original, b, c3);\n}\n\n// Draws the scene\nfloat RenderScene(vec3 position, out float distance)\n{\n    float noise = Turbulence(position * NoiseFrequency + Animation * time, 0.1, 1.5, 0.03) * NoiseAmplitude;\n    noise = clamp(abs(noise), 0.0, 1.0);\n    distance = SphereDist(position) - noise;\n    return noise;\n}\n\n// Basic ray marching method.\nvec4 March(vec3 rayOrigin, vec3 rayStep)\n{\n    vec3 position = rayOrigin;\n    float distance;\n    float displacement;\n    for (int step = MarchSteps; step >= 0; --step)\n    {\n        displacement = RenderScene(position, distance);\n        if (distance < 0.05) break;\n        position += rayStep * distance;\n    }\n    return mix(Shade(displacement), Background, float(distance >= 0.5));\n}\n\nbool IntersectSphere(vec3 ro, vec3 rd, vec3 pos, float radius, out vec3 intersectPoint)\n{\n    vec3 relDistance = (ro - pos);\n    float b = dot(relDistance, rd);\n    float c = dot(relDistance, relDistance) - radius * radius;\n    float d = b * b - c;\n    intersectPoint = ro + rd * (-b - sqrt(d));\n    return d >= 0.0;\n}\n\nvec2 fade(vec2 t) {return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);}\n\nfloat cnoise(vec2 P) {\n    vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\n    vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\n    Pi = mod(Pi, 289.0); // To avoid truncation effects in permutation\n    vec4 ix = Pi.xzxz;\n    vec4 iy = Pi.yyww;\n    vec4 fx = Pf.xzxz;\n    vec4 fy = Pf.yyww;\n    vec4 i = permute(permute(ix) + iy);\n    vec4 gx = 2.0 * fract(i * 0.0243902439) - 1.0; // 1/41 = 0.024...\n    vec4 gy = abs(gx) - 0.5;\n    vec4 tx = floor(gx + 0.5);\n    gx = gx - tx;\n    vec2 g00 = vec2(gx.x, gy.x);\n    vec2 g10 = vec2(gx.y, gy.y);\n    vec2 g01 = vec2(gx.z, gy.z);\n    vec2 g11 = vec2(gx.w, gy.w);\n    vec4 norm = 1.79284291400159 - 0.85373472095314 *\n    vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11));\n    g00 *= norm.x;\n    g01 *= norm.y;\n    g10 *= norm.z;\n    g11 *= norm.w;\n    float n00 = dot(g00, vec2(fx.x, fy.x));\n    float n10 = dot(g10, vec2(fx.y, fy.y));\n    float n01 = dot(g01, vec2(fx.z, fy.z));\n    float n11 = dot(g11, vec2(fx.w, fy.w));\n    vec2 fade_xy = fade(Pf.xy);\n    vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\n    float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\n    return 2.3 * n_xy;\n}\n\nvec4 doRust(vec4 col, float rust, vec2 uv) {\n    float noise = cnoise(uv * 9.0 + time * 0.1);\n    float step = smoothstep(rust - 0.05, rust + 0.05, noise);\n    float n = cnoise(uv * 10.0 + cnoise(vec2(time, uv.x))) + 0.3;\n    return col * step + vec4(n * 0.5, 0.1, 0.1, col.a) * (1. - step);\n}\n\nconst float circleThickness = 0.15;\nconst float circleRadius = 0.78;\n\nvoid main()\n{\n    vec2 p = vUv * 2.0 - 1.0;\n\n    // camera\n    vec3 ro = zoom * vec3(.7, .7, 0.0);\n    vec3 ww = normalize(vec3(0.0, 0.0, 0.0) - ro);\n    vec3 uu = normalize(cross(vec3(0.0, 1.0, 0.0), ww));\n    vec3 vv = normalize(cross(ww, uu));\n    vec3 rd = normalize(p.x * uu + p.y * vv + 1.5 * ww);\n    //    vec3 rd = normalize(p.x*uu + p.y*vv + zoom_f * ww);\n    vec4 col = Background;\n    vec3 origin;\n    if (IntersectSphere(ro, rd, ExpPosition, Radius + NoiseAmplitude * 6.0, origin))\n    {\n        col = March(origin, rd);\n    }\n\n    // After FX\n\n    float d = length(p);\n    if (saturation > 1.0) {\n        //  1.0 - smoothstep(radius-borderThickness, radius, d);\n        float t = 1.0 - smoothstep(0.0, circleRadius, abs(circleThickness - d));\n        col = mix(col * saturation, vec4(0.9, 0.9, 1.0, 0.5), clamp(t, 0.0, 0.5));\n    }\n\n    if (transitionShininess > 0.0) {\n        vec4 shineColor = vec4(0.8, 0.9, 1.0, 1.0);\n        col += shineColor * transitionShininess * clamp(1.0 - d * 0.9, 0.0, col.a);\n    }\n//\n//    if (rust > 0.0) {\n//\n//    }\n\n    col = doRust(col, rust, p);\n\n    gl_FragColor = col;\n\n    // Z buffer\n    #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    // Doing a strict comparison with == 1.0 can cause noise artifacts\n    // on some platforms. See issue #17623.\n    gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2(vFragDepth) * logDepthBufFC * 0.5;\n    #endif\n}\n",Z=s(7627),Q=s(6550);function J(e,t){return(0,Q.B$)(e,Object.assign({vertexMainOutro:"\n                    vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n                    vec3 scale = vec3(\n                      length(modelViewMatrix[0].xyz),\n                      length(modelViewMatrix[1].xyz),\n                      length(modelViewMatrix[2].xyz)\n                      );\n                    // size attenuation: scale *= -mvPosition.z * 0.2;\n                    mvPosition.xyz += position * scale;\n                    gl_Position = projectionMatrix * mvPosition;\n                    "},t))}const ee=Object.freeze({CREATE:"create",DESTROY:"destroy",SLASH:"slash",IP_ADDRESS:"ip_address",STATUS:"status",VERSION:"version",FORCED_LEAVE:"forced_to_leave",REQUESTED_LEAVE:"requested_to_leave",AWARD:"current_award",BOND_CHANGE:"bond",OBSERVE_CHAIN:"observe_chains",ACTIVE_BLOCK_HEIGHT:"active_block_height"});class te{constructor(e,t,s,n,i,o){this.type=e,this.node=t,this.prevNode=s,this.currValue=n,this.prevValue=i,this.nodeSet=o,this.isTramp=!!t&&""===t.address}toString(){const e=this.node?this.node.address:"?";return`NodeEvent(${this.type}, ${e}, ${this.currValue} => ${this.prevValue})`}}te.EVENT_TYPE=ee;const se=6,ne=Math.pow(10,8),ie=1/ne;function oe(e){return parseFloat(e)*ie}class re{constructor(e){if(e||(e={status:"Unknown",jail:{},bond_providers:{},preflight_status:{}}),this.address=e.node_address,this.status=e.status,this.bond=oe(e.total_bond),this.activeBlockHeight=+e.active_block_height,this.bondAddress=e.node_operator_address,this.statusSince=+e.status_since,this.requestedToLeave=!!e.requested_to_leave,this.forcedToLeave=!!e.forced_to_leave,this.leaveHeight=+e.leave_height,this.IPAddress=e.ip_address,this.version=e.version,this.slashPoints=+e.slash_points,e.jail&&(this.jail={address:e.jail.node_address,releaseHeight:+e.jail.release_height,reason:e.jail.reason}),this.currentAward=oe(e.current_award),this.observeChains={},e["observe_chains"]){for(let{chain:t,height:s}of e["observe_chains"])this.observeChains[t]=+s;delete this.observeChains["TERRA"]}if(e.preflight_status&&(this.preflightStatus={status:e.preflight_status.status,reason:e.preflight_status.reason,code:+e.preflight_status.code}),e.bond_providers&&(this.bondProviders={address:e.bond_providers["node_address"],fee:+e.bond_providers["node_operator_fee"]/1e4,providers:[]},e.bond_providers.providers))for(let{bond_address:t,bond:s}of e.bond_providers.providers)this.bondProviders.providers.push({bond_address:t,bond:oe(s)});this.shortAddress=this.address?this.address.substring(this.address.length-4):"?",this.IPInfo={flag:"ðŸ³ï¸"}}get isActive(){return this.status===ae.Active}get isStandby(){return this.status===ae.Standby||this.status===ae.Ready}}const ae={Standby:"Standby",Ready:"Ready",Whitelisted:"Whitelisted",Disabled:"Disabled",Active:"Active",Unknown:"Unknown"};var ce=s(8652),le=s.n(ce);const he=u.Scene.NodeObject,de=he.PlaneScale,ue=new h.BoxGeometry(de,de,de),me=new h.SphereGeometry(.5*he.PlaneScale,10,10),pe=16724736,ve=42.42,fe=1/Math.sqrt(.72);class ge extends Y{constructor(e){super(),this.node=e,this.normalizedBond=this.node.bond/1e6,this.mass=this.normalizedBond+1,this.o=new h.Group,this.o.name=this.name,this.attractors=[],this.mass=1+2*this.normalizedBond,this.friction=u.Physics.BaseFriction,this._makeSphere(),this._makeLabel(),this._reactingToSlash=!1,this._elevated=!1}get name(){return this.node.address}set elevated(e){e=Boolean(e),this._elevated!==e&&(this._elevated=e,this.material.uniforms.saturation.value=this._elevated?1.5:1,this.material.uniformsNeedUpdate=!0),this.friction=u.Physics[e?"HoverFriction":"BaseFriction"]}get elevated(){return this._elevated}_getSphereColor(){let e=1118481;const t=this.node.status;return t===ae.Standby?e=1473110:t===ae.Ready?e=1473167:t===ae.Active?e=j.getRandomSample([m.LightningBlue,m.YggdrasilGreen]):t===ae.Disabled?e=15597568:t===ae.Whitelisted?e=4473924:t===ae.Unknown&&(e=1118532),new h.Color(e)}_makeSphere(){this.mesh||(u.Scene.NodeObject.Simple?this._makeSimpleSphere():this._makeCoolSphere()),this.material.uniforms&&(this.material.uniforms.color.value=this._getSphereColor(),this.material.uniformsNeedUpdate=!0),this.mesh.name=this.name,this.mesh.renderOrder=1;const e=this.calculateScale;this.mesh.scale.setScalar(e),this.mesh.position.z=(0,Z.Qy)(-.1,.1),this.o.renderOrder=1,this.o.add(this.mesh)}get currentColor(){return this.material.uniforms.color.value}_makeSimpleSphere(){this.material=new h.MeshBasicMaterial({color:this._getSphereColor()}),this.mesh=new h.Mesh(me,this.material)}_makeCoolSphere(){return this.material||this._makeMaterial(),this.mesh=new h.Mesh(ue,this.material),this.mesh}_makeMaterial(){const e=-1;this.material=new h.ShaderMaterial({uniforms:{time:{value:j.getRandomFloat(0,100)},saturation:{value:1},color:{value:this._getSphereColor()},transitionShininess:{value:0},rust:{value:e}},vertexShader:X,fragmentShader:K,transparent:!0,depthTest:!0,depthWrite:!0})}get calculateScale(){const e=this.normalizedBond*he.MaxScale;return U.clamp(e,he.MinScale,he.MaxScale)}get realObject(){return this.o}get position(){return this.o.position}_makeLabel(){const e=this.node.address;if(e&&e.length>=4){const t=this.nameTextObj=new $.xv;t.text=e.slice(-4),t.font=u.Font.Main,t.fontWeight=900,t.fontSize=15,t.position.z=ve,t.color=this.node.status===ae.Active?16777215:12303291,t.anchorX="center",t.anchorY="middle",t.outlineWidth=2,t.sync(),t.renderOrder=100,t.name=this.name,t.material=J(new h.MeshBasicMaterial),t.scale.setScalar((0,O.clamp)(1.1*this.normalizedBond,.5,1.5)),this.o.add(t),this.labelObj=t}}dispose(){this.nameTextObj&&this.nameTextObj.dispose(),this.material.dispose()}get radius(){return Math.max(he.MinRadius,this.mesh.scale.x*he.PlaneScale*he.RadiusFactor)}static estimateRadiusOfGroup(e){let t=0;for(const n of e)t+=n.radius*n.radius;const s=Math.sqrt(t);return Math.max(.1,fe*s)}update(e){super.update(e),this.material&&(this.material.uniforms.time.value+=e)}updateFromCamera(e){const t=e.position.clone().sub(this.position);t.normalize().multiplyScalar(ve),this.nameTextObj.position.copy(t)}react(e){this.node=e.node,e.type===te.EVENT_TYPE.OBSERVE_CHAIN?this.reactChain(e.nodeSet):e.type===te.EVENT_TYPE.SLASH?this.reactSlash():e.type===te.EVENT_TYPE.STATUS?this.reactStatusChange(e.node.status):e.type===te.EVENT_TYPE.VERSION&&this.reactVersion()}reactChain(e){this._updateRust(e);const t=1,s=this.o.position.clone().normalize(),n=s.cross(new h.Vector3(0,0,1)).multiplyScalar(t);this.velocity.add(n)}reactVersion(){this._animateTransitionShininess()}reactSlash(){if(this._reactingToSlash||!this.material)return;const e=100;this.shootOut(e),this._animateScale(.82,200,600),this._reactingToSlash=!0;const t=this.material.uniforms.color.value.clone();this.material.uniforms.color.value.set(pe),this.material.uniformsNeedUpdate=!0,setTimeout((()=>{this.material.uniforms.color.value.set(t),this.material.uniformsNeedUpdate=!0,this._reactingToSlash=!1}),100)}reactStatusChange(e){console.log(`New status ${this.node.status} -> ${e}`),this._animateTransitionShininess()}_updateRust(e){this.material.uniforms.rust.value=this._getRust(e),this.material.uniformsNeedUpdate=!0}_getRust(e){if(!this.node.isActive)return-1;const t=u.Scene.NodeObject.Rust,{max:s}=e.getChainHeightLagAllSeconds(this.node),n=t.MaxLagToFullRust,i=W(0,n,s);return 2*(0,O.clamp)(i,0,t.MaxStrength)-1}_animateScale(e,t=1e3,s=1e3,n=le().Easing.Sinusoidal.InOut){const i=this.calculateScale,o=e*i;new(le().Tween)(this.mesh.scale).to(new h.Vector3(o,o,o),t).easing(n).start().chain(new(le().Tween)(this.mesh.scale).to(new h.Vector3(i,i,i),s).easing(n))}_animateTransitionShininess(){const e=500,t=2.5*e,s=le().Easing.Sinusoidal.InOut;new(le().Tween)(this.material.uniforms.transitionShininess).to({value:1},e).easing(s).start().onComplete((()=>{this._makeSphere()})).chain(new(le().Tween)(this.material.uniforms.transitionShininess).to({value:0},t).easing(s)),this._animateScale(1.5,e,t)}}var ye=s(5325),xe=s.n(ye);class we{constructor(){this._objects={},this.repelForce=0,this.rBush=new(xe()),this.repelEnabled=!0}getByName(e){return this._objects[e]}addObject(e,t){const s=this.getByName(e);if(s)return console.warn("PhysObj already exists. No nothing"),s;this._objects[e]=t}removeObject(e){const t=this.getByName(e);t?(t.dispose(),delete this._objects[e]):console.error("PhysObj not found!")}_repelForceCalculation(e){let t=this.rBush.search(e.boundingBox);for(const s of t)s.o!==e&&e.repel(s.o,this.repelForce)}_updateObject(e,t){e.nullifyForce(),this.repelEnabled&&this._repelForceCalculation(e),e.update(t)}update(e){isNaN(e)||(this.rBush=new(xe()),this.rBush.load(I().map(I().values(this._objects),(e=>({...e.boundingBox,o:e})))),I().forEach(I().values(this._objects),(t=>this._updateObject(t,e))))}doNSteps(e,t=.016){for(let s=0;s<e;++s)this.update(t)}get physicalObjects(){return I().values(this._objects)}get objectPositions(){return I().map(this.physicalObjects,"position")}get allNames(){return I().keys(this._objects)}dispose(){this._objects={},this.rBush.clear()}get size(){return I().size(this._objects)}get entries(){return I().entries(this._objects)}}class _e extends h.Object3D{constructor(e,t=20,s=-45,n=!1){super(),this.text=e;const i=this.label=new $.xv;i.font=u.Font.Main,i.fontSize=10,i.scale.set(t,t,t),i.color=16777215,i.anchorX="center",i.anchorY="middle",i.textAlign="center",i.text=e,n&&(i.material=J(new h.MeshBasicMaterial({transparent:!0}))),i.rotateX(h.MathUtils.degToRad(s)),i.sync(),this.t=i,this.add(i),this.animDuration=500,this.animDistance=1500,this.easeType=le().Easing.Back.Out}set color(e){this.t.color=e}get color(){return this.t.color}set opacity(e){this.t.fillOpacity=255*e}get opacity(){return this.t.material.opacity}animateIn(){this.t.position.z=this.animDistance,this.opacity=0,new(le().Tween)(this.t.position).to({z:0},this.animDuration).easing(this.easeType).start(),new(le().Tween)(this).to({opacity:1},this.animDuration).easing(this.easeType).start()}animateOut(e=!1){const t=5*this.animDuration;new(le().Tween)(this.t.position).to({z:5*-this.animDistance},t).easing(this.easeType).start(),new(le().Tween)(this).to({opacity:0},.5*t).easing(this.easeType).start().onComplete((()=>{e&&this.parent&&this.parent.remove(this)}))}}class be{constructor(e){this.scene=e,this.active=!1,this.isFlat=!0,this._labelsHash={}}handleObject(e){}reactEvent(e,t){}makeLabel({text:e,position:t,scale:s=20,rotation:n=-45,bb:i=!1,key:o=null,moveIfExists:r=!0}){if(!e||""===e)return;if(o=o||j.generateId(),r){const e=this.findLabelByKey(o);if(e)return new(le().Tween)(e.position).to(t,1e3).easing(le().Easing.Sinusoidal.InOut).start(),e}const a=new _e(e,s,n,i);return a.key=o,a.position.copy(t),this.scene.add(a),this._labelsHash[o]=a,a}onEnter(){}_triggerOnEnter(e,t){this.onEnter(e,t),this.active=!0,I().values(this._labelsHash).forEach((e=>e.animateIn()))}onLeave(){}_triggerOnLeave(e,t){this.onLeave(e,t),this.active=!1,this.clearLabels()}findLabelByKey(e){return this._labelsHash[e]}killLabelByKey(e){const t=this.findLabelByKey(e);e&&(t.animateOut(!0),delete this._labelsHash[e])}clearLabels(){I().values(this._labelsHash).forEach((e=>e.animateOut(!0))),this._labelsHash={}}update(e){}dispose(){}}class Se{constructor(e,t=0,s=0,n=0,i=-1,o=0){this.position=e,this.constCoeff=t,this.linearCoeff=s,this.quadraticCoeff=n,this.radius=i,this.relaxRadius=o}applyForceToDistance(e,t,s){const n=e.realObject.position,i=this.getForce(t,n,s);e.force.add(i)}getForce(e,t,s){const n=this.constCoeff+e*this.linearCoeff+e*e*this.quadraticCoeff;return s.clone().sub(t).normalize().multiplyScalar(n)}distance(e){const t=e.realObject.position;return this.position.distanceTo(t)}applyForce(e){const t=this.distance(e),s=this.radius<=0;(s||t<=this.radius)&&t>this.relaxRadius&&this.applyForceToDistance(e,t,this.position)}}Se.INFINITE=-1;class Pe extends Se{distance(e){return P(this.position,e.realObject.position)}applyForce(e){super.applyForce(e),this.squishZ(e)}squishZ(e){const t=e.realObject.position.z-this.position.z;let s=0;Math.abs(t)>1&&(s=100*-t),e.force.z=s}}class Te extends Pe{constructor(e,t=0,s=0,n=0,i=0){const o=U.centerOf(I().flatten(e));super(new h.Vector3(o.x,o.y,0),t,s,n,0,0),this.triangles=e,this.center=o,this.z=i}get allSectors(){const e=[];for(const t of this.triangles)e.push(new L(t[0],t[1])),e.push(new L(t[1],t[2])),e.push(new L(t[2],t[0]));return e}applyForce(e){if(!this.triangles||!this.triangles.length)return;const t=e.realObject.position,s={x:t.x,y:t.y},n=I().some(this.triangles,(e=>U.pointInTriangle(s,e)));if(this.squishZ(e),n)return;const i=I().minBy(this.allSectors,(e=>e.pDistance(s.x,s.y))),o=i.nearestPoint(s.x,s.y),r=new L(o,s).length;this.applyForceToDistance(e,r,new h.Vector3(o.x,o.y,this.z))}}class Ce{static original(){return[[{x:0,y:0},{x:133,y:-133},{x:-238,y:-291}],[{x:0,y:0},{x:-133,y:135},{x:291,y:311}]]}static triangles(e=0,t=0,s=1){const n=[];for(const i of this.original()){const o=[];for(const{x:n,y:r}of i)o.push({x:n*s+e,y:r*s+t});n.push(o)}return n}}class Ne extends be{constructor(e){super(e),this._circleRadius=350;const t=u.Physics.BaseForce;this.tcAttractor=new Te(Ce.triangles(0,100,1.8),t)}handleObject(e){e.attractors=this.tcAttractor}onEnter(e){const t=this.makeLabel({text:"THORChain",position:new h.Vector3(0,-580,-10),scale:18});t.opacity=.8,super.onEnter(),e.forEach((e=>{e.velocity.add(new h.Vector3(0,j.getRandomFloat(100,1e3),0))}))}}class ke extends h.Object3D{constructor(){super()}dispose(){}}const Me="*";class De extends be{constructor(e){super(e),this._circleRadius=350,this._sideDistance=600;const t=u.Physics.BaseForce;this.tcAttractor=new Te(Ce.triangles(0,100,1.6),t),this._standbyAttractors=[new Se(new h.Vector3(-this._sideDistance,0,0),t,0,0,0,.3*this._circleRadius),new Se(new h.Vector3(-this._sideDistance,0,0),.02*t)],this.attractors={[ae.Active]:[this.tcAttractor],[ae.Standby]:this._standbyAttractors,[ae.Ready]:this._standbyAttractors,[Me]:[new Se(new h.Vector3(this._sideDistance,0,0),t,0,0,0,.3*this._circleRadius),new Se(new h.Vector3(this._sideDistance,0,0),.02*t)]},this.nodeChurnTimer=new ke,this.scene.add(this.nodeChurnTimer),this.nodeChurnTimer.visible=!1}handleObject(e){e.attractors=null;const t=this.attractors[e.node.status];e.attractors=t||this.attractors[Me]}onEnter(e){const t=I().countBy(e,"node.status"),s=(t[ae.Standby]||0)+(t[ae.Ready]||0),n=t[ae.Active]||0,i=e.length-(s+n);this.makeLabel({text:"Active",position:new h.Vector3(0,-500,0),scale:20}),this.makeLabel({text:"Standby",position:new h.Vector3(-this._sideDistance,-420,0),scale:12}).opacity=.8,this.makeLabel({text:"Other",position:new h.Vector3(this._sideDistance,-420,0),scale:12}).opacity=.8,this.makeLabel({text:n,position:new h.Vector3(0,-650,0),scale:10}),this.makeLabel({text:s,position:new h.Vector3(-this._sideDistance,-500,0),scale:6}),this.makeLabel({text:i,position:new h.Vector3(this._sideDistance,-500,0),scale:6}),super.onEnter()}}class Ae extends Y{constructor(e,t,s,n,i,o){super(),this.name=n,this.position=new h.Vector3(e,t,0),this._radius=s,this.attractors=i,this.friction=o}get radius(){return this._radius}}const Ve=u.Physics.BaseFriction;class Ee{constructor(e,t,s=600,n=Ve,i=1){this.force=e,this.boundRadius=t,this.iterSteps=i,this.dt=.05,this.simulation=new we,this.simulation.repelForce=s,this.friction=n,this.metaAttractor=new Se(new h.Vector3,this.force,0,0,-1,0)}addCircle(e,t){this.simulation.addObject(e,new Ae(0,0,t,e,this.metaAttractor,this.friction))}arrangeAroundCenter(){if(!this.simulation.size)return this;const e=2*Math.PI/this.simulation.size,t=.5*this.boundRadius*.8;let s=.5*Math.PI;for(const n of this.simulation.allNames){const i=this.simulation.getByName(n);i&&(i.position.x=t*Math.cos(s),i.position.y=t*Math.sin(s)),s-=e}return this}clear(){this.simulation.dispose()}pack(e,t){return this.simulation.size?(e=e||this.dt,t=t||this.iterSteps,this.simulation.doNSteps(t,e),this):this}getResults(){const e={};for(const[t,{position:s,radius:n}]of this.simulation.entries)e[t]={position:s,radius:n};return e}}var Oe=s(6265),Ie=s.n(Oe),ze=s(3461),Fe=s.n(ze);class Re{constructor(e){this.ipAddress=e["ip"],this.countryCode=e["country_code"],this.country=e["country_name"],this.city=e["city"],this.latitude=e["latitude"],this.longitude=e["longitude"],this.providerName=e["org"],this.flag=Re.getFlagEmoji(this.countryCode)}static getFlagEmoji(e){if(e){const t=e.toUpperCase().split("").map((e=>127397+e.charCodeAt()));return String.fromCodePoint(...t)}return""}}const Be="UNKNOWN";class je{constructor(e=1440){this.expireMinutes=e,this._key="IPInfo2"}url(e){return`https://settings.thornode.org/api/node/ip/${e}`}async loadFromService(e){const t=await Ie().get(this.url(e.join(",")));return console.info(`Loaded IP info for (${e}) => ${t.status}`),I().mapValues(t.data,(e=>new Re(e)))}loadFromCache(e){return Fe().get(`${this._key}:${e}`)}saveToCache(e){if(!e||!e.ipAddress)return void console.warn("no data to save!");const t=e.ipAddress;Fe().set(`${this._key}:${t}`,e,this.expireMinutes)}async loadBunch(e){const t={},s=[];I().each(e,(e=>{const n=this.loadFromCache(e);n?t[e]=n:s.push(e)}));const n=I().chunk(s,50);for(const i of n){const e=await this.loadFromService(i);I().each(I().values(e),(e=>this.saveToCache(e))),I().extend(t,e)}return t}static refineProviderName(e){if(void 0===e)return Be;e=e.toUpperCase(),e=e.replace("ONLINE GMBH","");for(const t of e.split("-"))if("AS"!==t)return t;return e}}class Le extends be{constructor(e){super(e),this._attractorBanish=new Se(new h.Vector3(0,0,0),-100),this.attractors={},this.force=u.Physics.BaseForce,this.circlePacker=new Ee(this.force,1400,300,.02,1)}update(){this._transferAttractorsPositionFromPacker()}handleObject(e){if(e){let t=je.refineProviderName(e?.node?.IPInfo?.providerName??Be);e.attractors=this.attractors[t]??this._attractorBanish}}onEnter(e){this._createProviderAttractors(e),super.onEnter()}_createProviderAttractors(e){const t={};let s=null,n=0;for(const o of e){const e=o?.node?.IPInfo?.providerName??Be,i=je.refineProviderName(e);if(t[i]){const e=t[i];e.push(o),e.length>n&&(s=i,n=e.length)}else t[i]=[o]}this.circlePacker.clear(),this.attractors={};const i=I().sortBy(I().entries(t),[e=>e[1].length]);for(const[o,r]of i)o!==s&&this._makeAttractor(o,r,!0);this.circlePacker.arrangeAroundCenter(),this._transferAttractorsPositionFromPacker(),s&&this._makeAttractor(s,t[s],!1);for(const o of e)o.velocity.z=j.getRandomFloat(-1e3,1e3);this._makeLabels(t,s)}_makeAttractor(e,t,s){const n=1.05*ge.estimateRadiusOfGroup(t);return s&&this.circlePacker.addCircle(e,n),this.attractors[e]=new Se(new h.Vector3,this.force,0,0,0,n),n}_makeLabelForGroup(e,t,s){const n=e[t].length,i=`${t} (${n})`;this.makeLabel({text:i,position:new h.Vector3(s.x,s.y-180,60),scale:5})}_makeLabels(e,t){const s=this.circlePacker.getResults();for(const[n,{position:i}]of I().entries(s))this._makeLabelForGroup(e,n,i);t&&this._makeLabelForGroup(e,t,new h.Vector3)}_transferAttractorsPositionFromPacker(){const e=this.circlePacker.getResults();for(const[t,{position:s}]of I().entries(e)){const e=this.attractors[t];e?e.position.copy(s):console.warn(`no attr for ${t}`)}}}function Ue(e){return void 0===e||null===e||isNaN(e)}class He{constructor(e,t,s){this.x=e,this.y=t,this.z=s}static fromString(e){if(e instanceof He)return e;const t=I().map(e.split("."),(e=>parseInt(e))),s=t.length,n=t[0],i=s>1?t[1]:0,o=s>2?t[2]:0;return new He(n,i,o)}get isInvalid(){return Ue(this.x)||Ue(this.y)||Ue(this.z)}greater(e){return this.x>e.x||this.y>e.y||this.z>e.z}less(e){return this.x<e.x||this.y<e.y||this.z<e.z}equal(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}toString(){return`${this.x}.${this.y}.${this.z}`}inc(e=10,t=10){return this.z++,this.z>=e&&(this.z=0,this.y++,this.y>=t&&(this.x++,this.y=0)),this}get asInt(){return this.z+1e3*this.y+1e6*this.x}static loadVersions(e){return I().map(e,(e=>He.fromString(e)))}static maximumVersion(e){return I().maxBy(He.loadVersions(e),(e=>e.asInt))}static minimumVersion(e){return I().minBy(He.loadVersions(e),(e=>e.asInt))}static getVersionSet(e,t="node.version"){return He.loadVersions(I().uniq(I().map(e,t)))}static getSemanticVersionsDistribution(e,t="node.version",s="node.isActive"){const n=I().filter(e,(e=>I().get(e,s))),i=He.getVersionSet(n,t),o=He.maximumVersion(i),r=He.minimumVersion(i),a=I().differenceBy(i,I().compact([o,r]),(e=>e.asInt)),c=I().map(a,(e=>e.toString())),l={};for(const h of e){const e=I().get(h,t),s=He.fromString(e);let n=null,i="";const a=s.equal(r),d=s.equal(o);d&&a?(n=r.toString(),i="latest and active"):d?(n=o.toString(),i="latest"):a?(n=r.toString(),i="active"):I().includes(c,e)?(n=e,i="interim"):e&&"0.0.0"!==e?(n=`${s.x}.X.X`,i="old"):n="unknown",l[n]||(l[n]={objects:[],comment:i,mostPopular:!1,isActive:h.node.isActive}),l[n].objects.push(h)}if(!I().isEmpty(l)){const e=I().maxBy(I().values(l),(e=>e.objects.length));e.mostPopular=!0}return l}}class Ge extends be{constructor(e){super(e),this._circleRadius=350,this._sideDistance=600,this.force=u.Physics.BaseForce,this._attractorsByKey={},this._attractorsByVersion={},this._attractorBanish=new Se(new h.Vector3(0,0,0),-100),this._previousKeys=[],this._versionDist={}}reactEvent(e,t){e.type===te.EVENT_TYPE.VERSION&&(console.log(`New version detected: ${e.currValue}`),this._packAttractorPositions(t),this._makeLabels())}handleObject(e){if(e){let t=e.node.version;e.attractors=this._attractorsByVersion[t]??this._attractorBanish}}onEnter(e){this._packAttractorPositions(e),this._makeLabels(),this.makeLabel({text:"Versions",position:new h.Vector3(0,-630,-10),scale:14})}_packAttractorPositions(e){this._versionDist=He.getSemanticVersionsDistribution(e);const t=100,s=1.2;let n=0,i=0;for(const a of I().values(this._versionDist))a.radius=s*ge.estimateRadiusOfGroup(a.objects),++n,i+=2*a.radius;i+=Math.max(0,n-1)*t;let o=.5*-i;this._attractorsByVersion={},this._attractorsByKey={};let r=I().entries(this._versionDist);r=I().sortBy(r,(e=>e[0]));for(const[a,c]of r){const e=c.radius,s=new Se(new h.Vector3(o+e,0,0),this.force,0,0,0,.9*c.radius);o+=t+2*e,this._attractorsByKey[a]=s;for(const t of c.objects)this._attractorsByVersion[t.node.version]=s}}_makeLabels(){const e=[];for(const[s,n]of I().entries(this._versionDist)){e.push(s);const t=this._attractorsByKey[s];if(t){let e,i,o="\n"+n.comment;"latest"===n.comment?e="#41e9ff":"latest and active"===n.comment?e="#1dfc53":"active"===n.comment?e="#16f14b":"interim"===n.comment&&(e="#1cc245",o=""),i="unknown"===s?"Unknown":`v. ${s} (${n.objects.length})${o}`;const r=new h.Vector3(t.position.x,t.position.y-1.1*t.relaxRadius-30,50),a=this.makeLabel({text:i,position:r,scale:2.5,key:s}).t;n.isActive||(a.opacity=.9),e&&(a.color=e)}}const t=I().difference(this._previousKeys,e);I().forEach(t,(e=>{this.killLabelByKey(e)})),t.length&&console.log(`Removing ${t.length} version labels...`),this._previousKeys=e}}class qe extends be{constructor(e){super(e),this.nameToAttractor={},this.force=u.Physics.BaseForce,this.center=new h.Vector3(0,120),this._noBondAttractor=new Se(new h.Vector3(0,-2e3,0),this.force)}handleObject(e){e.attractors=this.nameToAttractor[e.node.address]}onEnter(e){const t=this.makeLabel({text:"Bonds",position:new h.Vector3(0,-630,-10),scale:14});t.opacity=.8,e=I().sortBy(e,"node.bond");const s=e.length;this.nameToAttractor={},0!==s&&(this._positionateOnSpiral(e),super.onEnter())}_positionateOnSpiral(e){const t=e.length;let s=0,n=34;const i=1.5;let o=5.9,r=.5;const a=.995,c=.991;for(let l=0;l<t;++l){const t=this.center.x+i*n*Math.cos(s),h=this.center.y+n*Math.sin(s);this._addAttractor(e[l],t,h)&&(n+=o,s+=r,o*=a,r*=c)}}_positionateOnGrid(e){const t=e.length,s=Math.ceil(Math.sqrt(t)),n=Math.ceil(t/s),i=100,o=s*i,r=n*i,a=.5*o,c=.5*r;for(let l=0;l<t;++l){const t=l%s,n=Math.floor(l/s),o=i*t-a,r=i*n-c;this._addAttractor(e[l],o,r)}}_addAttractor(e,t,s){const n=e.node.bond;if(n>1){const i=0;this.nameToAttractor[e.node.address]=new Se(new h.Vector3(t,s,i),this.force,0,0,-1,10);const o=this.makeLabel({text:q(n),position:new h.Vector3(t,s-e.radius-19,-10),scale:1,rotation:-22});return e.node.isActive?o.color=e.currentColor:o.color="#999",!0}return this.nameToAttractor[e.node.address]=this._noBondAttractor,!1}}var We="//uniform float time;\n//uniform float saturation;\n//uniform vec3 color;\n\nvarying vec2 vUv;\nvarying vec3 vNormal;\n\nconst vec3 ATMO_COLOR = vec3(0.3, 0.6, 1.0);\nconst vec3 FORWARD = vec3(0.0, 0.0, 1.0);\n\nuniform sampler2D globeTexture;\n\nvoid main(void) {\n    float intensity = 1.05 - dot(vNormal, FORWARD);\n    vec3 atmo = clamp(ATMO_COLOR * pow(intensity, 1.5), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n//    vec3 atmo = vec3(0.0, 0.0, 0.0);\n    gl_FragColor = vec4(atmo + texture2D(globeTexture, vUv).xyz, 1.0);\n    //    gl_FragColor = texture2D(globeTexture, vUv);\n}\n\n",$e="varying vec2 vUv;\nvarying vec3 vNormal;\n\nvoid main()\n{\n    vUv = uv;\n    vNormal = normalMatrix * normalize(normal);\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n}";class Ye extends be{constructor(e){super(e),this.isFlat=!1,this.force=1.2*u.Physics.BaseForce,this._banishAttractor=new Se(new h.Vector3(0,-2e3,0),this.force),this._nameToAttractor={},this._coordToAttractor={}}handleObject(e){const t=this._nameToAttractor[e.name];e.attractors=t?[t]:[this._banishAttractor]}onEnter(e,t){super.onEnter(),t.repelEnabled=!1,this._createAttractorsStacked(e),u.Scene.Globe.Enabled&&(this._makeGlobe(),this._putInGlobe())}onLeave(e,t){this._destroyGlobe(),I().forEach(e,(e=>e.shootOut(2e3))),super.onLeave(),t.repelEnabled=!0}_makeGlobe(){if(this.globeMesh)return;const e=new h.TextureLoader,t=u.Scene.Globe,s=new h.SphereGeometry(t.Radius,t.Details,t.Details),n=new h.ShaderMaterial({name:"AtmosphereShaderMaterial",fragmentShader:We,vertexShader:$e,uniforms:{globeTexture:{value:e.load(u.Scene.Globe.TextureMap)}}});if(this.globeMesh=new h.Mesh(s,n),this.globeMesh.renderOrder=9999,this.scene.add(this.globeMesh),t.Clouds.Opacity>0){const n=new h.MeshPhongMaterial({map:e.load(t.Clouds.Texture),side:h.DoubleSide,opacity:t.Clouds.Opacity,transparent:!0,depthWrite:!1,blending:h.AdditiveBlending});this.cloudMesh=new h.Mesh(s,n),this.cloudMesh.scale.setScalar(t.Clouds.ElevationScale),this.globeMesh.add(this.cloudMesh),this.cloudMesh2=new h.Mesh(s,n),this.cloudMesh2.scale.setScalar(t.Clouds.ElevationScale),this.globeMesh.add(this.cloudMesh2)}}_putInGlobe(){this.globeMesh.scale.set(.01,.01,.01),new(le().Tween)(this.globeMesh.scale).to(new h.Vector3(1,1,1)).easing(le().Easing.Sinusoidal.InOut).start()}_destroyGlobe(){if(!this.globeMesh)return;const e=this.globeMesh;new(le().Tween)(e.scale).to(new h.Vector3(.01,.01,.01)).easing(le().Easing.Sinusoidal.InOut).onComplete((()=>{e.parent.remove(e)})).start(),this.globeMesh=null}update(e){super.update(e),this.cloudMesh&&(this.cloudMesh.rotation.y+=.02*e),this.cloudMesh2&&(this.cloudMesh2.rotation.y-=.04*e)}_createAttractors(e){const t=u.Scene.Globe.Radius+u.Scene.Globe.NodeElevation;this._nameToAttractor={},this._coordToAttractor={};for(const s of e){const e=s.node.IPInfo;if(e&&s.node.IPAddress){const n=`${e.longitude}, ${e.latitude}`;let i=this._coordToAttractor[n];if(!i){const s=S(e.longitude,e.latitude,t);i=this._coordToAttractor[n]=new Se(s,this.force,0,0,Se.INFINITE,5)}this._nameToAttractor[s.node.address]=i}else this._nameToAttractor[s.node.address]=this._banishAttractor}console.log(`Total attractors were made: ${this._coordToAttractor.length}.`)}_createAttractorsStacked(e){this._nameToAttractor={},this._coordToStack={};for(const s of e){const e=s.node.IPInfo;if(e&&s.node.IPAddress){const t=`${e.longitude}, ${e.latitude}`;let n=this._coordToStack[t];n||(this._coordToStack[t]=n={stack:[],longitude:e.longitude,latitude:e.latitude}),n.stack.push(s)}else this._nameToAttractor[s.node.address]=this._banishAttractor}const t=u.Scene.Globe.Radius+u.Scene.Globe.NodeElevation;for(const{stack:s,longitude:n,latitude:i}of I().values(this._coordToStack)){const e=I().sortBy(s,(e=>-e.node.bond));let o=t;for(const t of e){const e=S(n,i,o);this._nameToAttractor[t.node.address]=new Se(e,this.force,0,0,Se.INFINITE,5),o+=2.1*t.radius}}console.log(`Total attractors were made: ${this._coordToAttractor.length}.`)}}const Xe=Object.freeze({Normal:"normal",Status:"status",Provider:"provider",Version:"version",Bond:"bond",Geo:"geo"});class Ke extends we{constructor(e){super(),this.holder=new h.Group,e.add(this.holder),this._currentIdent=0,this.parent=e,this._modeNormal=new Ne(this.parent),this._modeStatus=new De(this.parent),this._modeProvider=new Le(this.parent),this._modeVersion=new Ge(this.parent),this._modeBond=new qe(this.parent),this._modeGeo=new Ye(this.parent),this._selector={[Xe.Normal]:this._modeNormal,[Xe.Status]:this._modeStatus,[Xe.Provider]:this._modeProvider,[Xe.Version]:this._modeVersion,[Xe.Bond]:this._modeBond,[Xe.Geo]:this._modeGeo},this._selectedModeHandler=this._modeNormal,this.mode=Xe.Normal,this.repelForce=u.Physics.RepelForce}genIdent(e){return e.address??String(this._currentIdent++)}_placeNodeObject(e){const t=j.randomOnCircle(2e3);e.o.position.copy(t),this.holder.add(e.o)}createNewNode(e,t){const s=this.genIdent(e),n=this.getByName(s);if(n)return console.warn("NodeObject already exists. No nothing"),n;console.info(`Create node ${s}.`);const i=new ge(e);return i._updateRust(t),this._placeNodeObject(i),this.addObject(s,i),i}destroyNode(e){const t=e.address??e,s=this.getByName(t);s?(console.info(`Destroy node ${t}.`),s.dispose(),this.holder.remove(s.o),super.removeObject(t)):console.error("node not found!")}set mode(e){this._mode!==e&&(this._mode=e,this._selectedModeHandler._triggerOnLeave(this.physicalObjects,this),this._selectedModeHandler=this._selector[this._mode],this._selectedModeHandler._triggerOnEnter(this.physicalObjects,this),console.log(`Set Mode: ${e}`))}_updateObject(e,t){e&&(this._selectedModeHandler.handleObject(e),super._updateObject(e,t))}reactEvent(e){const t=j.getRandomFloat(0,u.DataSource.ReactRandomDelay);setTimeout((()=>{const t=this.getByName(e.node.address);t&&(t.react(e),this._selectedModeHandler.reactEvent(e,this.physicalObjects))}),t)}update(e){this._selectedModeHandler.update(e),super.update(e)}updateFromCamera(e){I().each(this.physicalObjects,(t=>t.updateFromCamera(e)))}dispose(){super.dispose(),b(this.holder);for(const e of this.physicalObjects)e.dispose();for(const e of Object.values(this._selector))e.dispose()}setElevatedNode(e){for(const t of this.physicalObjects)t.elevated=t.name===e}get isCurrentModeFlat(){return this._selectedModeHandler.isFlat}}class Ze{constructor(e,t){this.prev=e,this.curr=t}extractEvents(){const e=[],t=(t,s,n,i)=>{i=i||"address",e.push(new te(t,s,n,s?s[i]:"",n?n[i]:"",this.curr))},s=I().difference(this.curr.nameSet,this.prev.nameSet);for(const a of s){const e=this.curr.byAddress[a];t(te.EVENT_TYPE.CREATE,e,e)}const n=I().difference(this.prev.nameSet,this.curr.nameSet);for(const a of n){const e=this.prev.byAddress[a];t(te.EVENT_TYPE.DESTROY,e,e)}const i=te.EVENT_TYPE,o={slashPoints:i.SLASH,total_bond:i.BOND_CHANGE,IPAddress:i.IP_ADDRESS,status:i.STATUS,height:i.ACTIVE_BLOCK_HEIGHT,currentAward:i.AWARD,observeChains:i.OBSERVE_CHAIN,version:i.VERSION},r=I().intersection(this.curr.nameSet,this.prev.nameSet);for(const a of r){const e=this.prev.byAddress[a],s=this.curr.byAddress[a],n=I().union(I().keys(e),I().keys(s)),i=I().filter(n,(t=>!I().isEqual(e[t],s[t])));for(const r of i){const n=o[r];n&&t(n,s,e,r)}}return e}}class Qe{constructor(e=10){this.tick=1,this.period=e,this.enabled=!0,this.juggleStatus=!0,this.juggleVersion=!0,this.memorizeVersions={}}handleNodes(e){return this.enabled&&(this.tick%this.period===0&&(e=this._juggleNodes(e)),this.tick++),e}_juggleNodes(e){return this.juggleStatus&&(e=this._juggleNodesStatus(e)),this.juggleVersion&&(e=this._juggleNodesVersion(e)),e}_juggleNodesStatus(e){const t=j.getRandomIntRange(2,7),s=j.getRandomIntRange(2,7);return console.warn(`Attention! _juggleNodes: IN: ${t}, OUT: ${s}!`),e.filteredByStatus(ae.Active).sampleRandomly(s).setStatusAll(ae.Standby),e.filteredByStatus(ae.Standby).sampleRandomly(t).setStatusAll(ae.Active),e}_nextVersion(e){return He.fromString(e).inc(10,100).toString()}_juggleNodesVersion(e){const t=1,s=this;return I().each(e.nodes,(e=>{const t=s.memorizeVersions[e.address];t&&(e.version=t)})),e.sampleRandomly(t).nodes.forEach((e=>{const t=e.version;e.version=this._nextVersion(e.version),s.memorizeVersions[e.address]=e.version,console.warn(`Debug upgrade ${e.shortAddress}: ${t} => ${e.version}`)})),e}}const Je={ETH:12.8,BTC:600,BCH:600,LTC:150,BNB:.4,THOR:6,DOGE:60,TERRA:6.64,GAIA:6.85,AVAX:3};class et{constructor(e,t=!0){this.nodes=e||[],this.total=this.nodes.length,t&&(this._nodesWithNames=I().filter(this.nodes,(e=>e.address)),this.byAddress=I().keyBy(this._nodesWithNames,"address"),this.nameSet=I().keys(this.byAddress),this.totalBond=I().sumBy(this.nodes,(e=>e.bond)),this.maxSlashNode=I().maxBy(this.nodes,(e=>e.slashPoints)),this.trampCount=this.total-this._nodesWithNames.length,this.maxAgeNode=I().maxBy(I().filter(this.nodes,(e=>e.activeBlockHeight&&e.activeBlockHeight>0)),(e=>e.activeBlockHeight)),this.ranks={bond:this._makeRanking("bond","desc"),slash:this._makeRanking("slashPoints"),age:this._makeRanking("activeBlockHeight"),award:this._makeRanking("currentAward")},this.topHeights=this.calculateTopBlockHeight(3),this.topVersion=this.calculateTopVersion())}_makeRanking(e,t="asc"){const s=I().orderBy(this._nodesWithNames,[e],[t]),n=I().map(s,"address"),i=Array.from(Array(s.length),((e,t)=>t+1));return Object.fromEntries(I().zip(n,i))}findByAddress(e){return this.byAddress[e]}sortedNodes(e,t=!0){const s=t?1:-1;return new et(I().sortBy(this.nodes,(t=>s*t[e])))}filteredByStatus(e){return new et(I().filter(this.nodes,(t=>t.status===e)))}get sortedByBond(){return this.sortedNodes("bond")}get sortedByAge(){return this.sortedNodes("statusSince")}get ipAddresses(){return I().compact(I().uniq(I().map(this.nodes,(e=>e.IPAddress))))}sampleRandomly(e){return new et(I().sampleSize(this.nodes,e))}setStatusAll(e){I().forEach(this.nodes,(t=>t.status=e))}bondPercentOfTotal(e){return(e/this.totalBond*100).toFixed(2)}get length(){return this.total}_calculateTopBlockOneChain(e,t){const s=I().map(Object.keys(t),(e=>parseInt(e)));s.sort().reverse();for(const n of s){const s=t[n];if(s>=e)return n}return null}calculateTopBlockHeight(e=2){const t=Array.from(new Set(I().flatten(I().map(this._nodesWithNames,(e=>I().keys(e.observeChains)))))),s=I().map(t,(e=>I().countBy(this._nodesWithNames,(t=>t.observeChains[e]??0))));return I().zipObject(t,I().map(t,((t,n)=>this._calculateTopBlockOneChain(e,s[n]))))}calculateTopVersion(){if(0===this.nodes.length)return null;let e=He.fromString(this.nodes[0].version);for(let t=1;t<this.nodes.length;++t){const s=He.fromString(this.nodes[t].version);s.greater(e)&&(e=s)}return e.toString()}estimateTimestampAtBlock(e,t){const s=e-t;return Date.now()-s*se*1e3}getChainHeightLagBlocks(e,t){return(this.topHeights[t]??0)-(e.observeChains[t]??0)}getChainHeightLagSeconds(e,t){const s=Je[t]??1;return s*this.getChainHeightLagBlocks(e,t)}getChainHeightLagAllSeconds(e){const t=I().keys(this.topHeights);if(!t.length)return 0;const s={sum:0,max:0};for(const n of t){const t=this.getChainHeightLagSeconds(e,n);s.max=Math.max(s.max,t),s.sum+=t}return s.avg=s.sum/t.length,s}}class tt{constructor(e,t){this.period=t,this.baseUrl=e,this._isRunning=!1,this._timer=0,this.callback=()=>0,this.ipAddressLoader=new je}run(){this._isRunning?console.warn(`${this.toString()} is already running`):(this._isRunning=!0,console.info(`${this.toString()} started!`),this._tick().then(),this._timer=setInterval((()=>{this._tick().then()}),this.period))}stop(){this._isRunning&&(clearInterval(this._timer),this._timer=0,this._isRunning=!1,console.info(`${this.toString()} stopped.`))}toString(){return`URLDataSource(${this.baseUrl}, ${this.period/1e3} sec)`}get isRunning(){return this._isRunning}async dataProcess(e){return e}get url(){return this.baseUrl}async _load(){return await Ie().get(this.url,{headers:{"Content-type":"application/json"}})}async loadOnce(){return await this.dataProcess(await this._load())}async _tick(){try{const e=await this._load();if(this.callback){const t=await this.dataProcess(e.data);this.callback(t)}}catch(e){throw console.error(`${this.toString()} tick failed: ${e}`),e}}}class st extends tt{get url(){return this.baseUrl+"/thorchain/nodes"}async dataProcess(e){const t=new et(I().map(e,(e=>new re(e))));let s={};try{s=await this.ipAddressLoader.loadBunch(t.ipAddresses)}catch(n){console.error("failed to load IPInfo")}for(const i of t.nodes)i.IPAddress&&(i.IPInfo=s[i.IPAddress]);return t}}class nt extends tt{get url(){return this.baseUrl+"/thorchain/lastblock"}async dataProcess(e){const t={};for(const s of e)t["THOR"]=+s["thorchain"],t[s["chain"]]=+s["last_observed_in"];return t}}class it extends tt{get url(){return this.baseUrl+"/v2/network"}async dataProcess(e){return{nextChurnHeight:+e["nextChurnHeight"]}}}const ot={lastBlock:{THOR:0},lastNodes:[]};class rt{constructor(e,t){this.scene=e,this.camera=t,this.prevNodes=new et([],!1),this.nodes=new et([],!1),this.nodeGroup=new Ke(this.scene),this._firstTime=!0,this._runDataSource(),this._fullyLoaded=!1,this._nodeJuggler=new Qe(3),this._nodeJuggler.enabled=u.DataSource.NodeJuggler.Enabled}_runDataSource(){this._dataSources=[];const e=u.DataSource,t=new st(e.THORNodeURL,e.Nodes.PollPeriod);t.callback=this.handleData.bind(this),t.run();const s=new nt(e.THORNodeURL,e.LastBlock.PollPeriod);s.callback=e=>{ot.lastBlock=e},s.run();const n=new it(e.MidgardURL,e.Network.PollPeriod);n.callback=e=>{console.log(e),ot.lastBlock&&N.emit(C.NodeChurnUpdate,{...e,lastBlock:ot.lastBlock})},n.run(),this._dataSources.push(t,s,n)}handleData(e){if(!e)return void console.error("No nodes to handle!");this._fullyLoaded||(this._fullyLoaded=!0,N.emit(C.FullyLoaded)),e=this._nodeJuggler.handleNodes(e),ot.lastNodes=e,N.emit(C.DataSourceTick,e),this.prevNodes=this.nodes,this.nodes=e;const t=new Ze(this.prevNodes,this.nodes),s=t.extractEvents();console.info(`Handle Data tick! Total: ${s.length} events.`);for(const n of s){const t=n.node;t.address&&(n.type===te.EVENT_TYPE.CREATE?this.nodeGroup.createNewNode(t,e):n.type===te.EVENT_TYPE.DESTROY?this.nodeGroup.destroyNode(t):this.nodeGroup.reactEvent(n))}if(this._firstTime){for(let e=0;e<u.Physics.Startup.SimulationSteps;++e)this.nodeGroup.update(u.Physics.Startup.DeltaTime);this._firstTime=!1}s.length&&N.emit(C.Activity)}update(e){this.nodeGroup.update(e),this.nodeGroup.updateFromCamera(this.camera)}dispose(){for(const e of this._dataSources)e.stop();this._dataSources=[],this.nodeGroup.dispose(),b(this.scene)}findNodeByAddress(e){return this.nodes.byAddress[e]}pick(e){const t=this.findNodeByAddress(e);console.log(t)}}var at='/*\n * Copyright 2014 Roman Bobniev (FatumR)\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nvarying vec2 vUv;\nuniform float time;\n\n#define OCTAVES  8.0\n\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nfloat rand2(vec2 co){\n    return fract(cos(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\n// Rough Value noise implementation\nfloat valueNoiseSimple(vec2 vl) {\n    float minStep = 1.0;\n\n    vec2 grid = floor(vl);\n    vec2 gridPnt1 = grid;\n    vec2 gridPnt2 = vec2(grid.x, grid.y + minStep);\n    vec2 gridPnt3 = vec2(grid.x + minStep, grid.y);\n    vec2 gridPnt4 = vec2(gridPnt3.x, gridPnt2.y);\n\n    float s = rand2(grid);\n    float t = rand2(gridPnt3);\n    float u = rand2(gridPnt2);\n    float v = rand2(gridPnt4);\n\n    float x1 = smoothstep(0., 1., fract(vl.x));\n    float interpX1 = mix(s, t, x1);\n    float interpX2 = mix(u, v, x1);\n\n    float y = smoothstep(0., 1., fract(vl.y));\n    float interpY = mix(interpX1, interpX2, y);\n\n    return interpY;\n}\n\n\nfloat fractalNoise(vec2 vl) {\n    float persistance = 2.0;\n    float amplitude = 0.5;\n    float rez = 0.0;\n    vec2 p = vl;\n\n    for (float i = 0.0; i < OCTAVES; i++) {\n        rez += amplitude * valueNoiseSimple(p);\n        amplitude /= persistance;\n        p *= persistance;\n    }\n    return rez;\n}\n\nfloat complexFBM(vec2 p) {\n    float slow = time / 2.5;\n    float fast = time / .5;\n    vec2 offset1 = vec2(slow, 0.);// Main front\n    vec2 offset2 = vec2(sin(fast)* 0.1, 0.);// sub fronts\n\n    return\n    fractalNoise(p + offset1 + fractalNoise(\n    p + fractalNoise(\n    p + 2. * fractalNoise(p - offset2)\n    )\n    )\n    );\n}\n\nconst vec3 blueColor = vec3(0.029411765, 0.207843137, 0.250392157);\nconst vec3 blackColor2 = vec3(0.00803922, 0.0203921569, 0.015686275);\n\nvoid main() {\n    vec2 uv = vUv;\n    uv = uv * vec2(2.0, 0.5) - 1.0;\n\n    vec3 rez = mix(blackColor2, blueColor, complexFBM(uv));\n    gl_FragColor = vec4(rez, 1.0);\n}';const ct=new h.PlaneBufferGeometry(2,2,1,1),lt="\t\nuniform vec4 uSize; \t\t//w h t l \nvarying vec2 vUv;\n\nvoid main(){\n\tvUv = uv;\n\tvec2 transformed = \n\t    position.xy * uSize.xy \n\t    - vec2(1.,-1.) + vec2( uSize.x ,  -uSize.y ) \n\t    + vec2( uSize.w , - uSize.z ) * 2.;\n\tgl_Position = vec4( transformed , 1. , 1. );\n}\n",ht="\nvarying vec2 vUv;\nuniform sampler2D uTexture;\n// uniform float time;\n\nvoid main(){\n\tgl_FragColor = texture2D( uTexture , vUv );\n}\t\n";class dt extends h.Mesh{constructor({width:e=1,height:t=1,top:s=0,left:n=0,texture:i=null,fragmentShader:o=!1}={}){super(ct,new h.ShaderMaterial({uniforms:{uTexture:{type:"t",value:i},uSize:{type:"v4",value:new h.Vector4(1,1,0,0)},time:{value:0}},vertexShader:lt,fragmentShader:o||ht,depthWrite:!1})),this.frustumCulled=!1,this.renderOrder=-1,this.top=s,this.left=n,this.width=e,this.height=t,this._pixels=[!1,!1,!1,!1],this._componentSetters=[this.setWidth,this.setHeight,this.setTop,this.setLeft],this._components=["width","height","top","left"],this.screenSize=new h.Vector2(1,1),this.setSize(e,t),this.setOffset(s,n)}update(e){this.material.uniforms.time.value+=e}setScreenSize(e,t){this.screenSize.set(e,t),this._pixels.forEach(((e,t)=>{e&&this._componentSetters[t].call(this,this[this._components[t]])}))}setSize(e,t){this.setWidth(e),this.setHeight(t)}setWidth(e){this.width=e,isNaN(e)?(this.material.uniforms.uSize.value.x=parseInt(e)/this.screenSize.x,this._pixels[0]=!0):(this.material.uniforms.uSize.value.x=e,this._pixels[0]=!1)}setHeight(e){this.height=e,isNaN(e)?(this.material.uniforms.uSize.value.y=parseInt(e)/this.screenSize.y,this._pixels[1]=!0):(this.material.uniforms.uSize.value.y=e,this._pixels[1]=!1)}setOffset(e,t){this.setLeft(t),this.setTop(e)}setTop(e){this.top=e,isNaN(e)?(this.material.uniforms.uSize.value.z=parseInt(e)/this.screenSize.y,this._pixels[2]=!0):(this.material.uniforms.uSize.value.z=e,this._pixels[2]=!1)}setLeft(e){this.left=e,isNaN(e)?(this.material.uniforms.uSize.value.w=parseInt(e)/this.screenSize.x,this._pixels[3]=!0):(this.material.uniforms.uSize.value.w=e,this._pixels[3]=!1)}}class ut{constructor(e){this.scene=e}install(){}update(e){}setSize(e,t){}}class mt extends ut{constructor(e){super(e),this.quad=new dt({fragmentShader:at})}install(){this.scene.add(this.quad)}update(e){this.quad.update(e)}setSize(e,t){this.quad&&this.quad.setScreenSize(e,t)}}const pt={class:"control-panel"},vt=["onClick"];function ft(e,t,s,n,o,r){return(0,i.wg)(),(0,i.iD)("div",pt,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(r.modes,(e=>((0,i.wg)(),(0,i.iD)("button",{onClick:t=>r.setSceneMode(e.value),class:(0,g.C_)(r.isButtonSelectedClass(e.value)),key:e.value},(0,g.zw)(e.text),11,vt)))),128))])}var gt={name:"ControlPanel",components:{},emits:["mode-selected"],props:{},data(){return{selectedMode:Xe.Normal,activeOnly:!1}},computed:{modes(){return[{value:Xe.Normal,text:"NORMAL"},{value:Xe.Status,text:"STATUS"},{value:Xe.Provider,text:"PROVIDER"},{value:Xe.Version,text:"VERSION"},{value:Xe.Bond,text:"BOND"},{value:Xe.Geo,text:"GEO"}]}},methods:{isButtonSelectedClass(e){return{"button-selected":this.selectedMode===e}},setSceneMode(e){this.selectedMode=e,this.$emit("mode-selected",e)}},mounted(){u.Scene.InitialMode&&u.Scene.InitialMode!==Xe.Normal&&setTimeout((()=>this.setSceneMode(u.Scene.InitialMode)),1e3)}};const yt=(0,A.Z)(gt,[["render",ft],["__scopeId","data-v-6f81aa75"]]);var xt=yt;const wt=(0,i._)("h1",null,"Node details",-1),_t={class:"prop-grid"},bt={class:"prop-box"},St=(0,i._)("div",{class:"category"},"Status",-1),Pt={class:"prop-box"},Tt=(0,i._)("div",{class:"category"},"Since",-1),Ct={class:"value"},Nt={key:0,content:"The oldest active node"},kt={class:"prop-box"},Mt=(0,i._)("div",{class:"category"},"ðŸ’½ Version",-1),Dt={class:"value"},At={key:0,content:"Latest version"},Vt={key:1,content:"Consider upgrading your node!"},Et={key:0,class:"prop-box"},Ot=(0,i._)("div",{class:"category"},"ðŸ•¸ï¸ IP address",-1),It={class:"value"},zt=["href"],Ft={key:1,class:"prop-box"},Rt=(0,i._)("div",{class:"category"},"ðŸ“ Location",-1),Bt={class:"value"},jt={key:2,class:"prop-box"},Lt=(0,i._)("div",{class:"category"},"â˜ï¸ Provider",-1),Ut={class:"value"},Ht={key:3,class:"prop-box"},Gt=(0,i._)("div",{class:"value"},"Unknown IP address",-1),qt=[Gt],Wt={class:"prop-box"},$t=(0,i._)("div",{class:"category"},"ðŸŒ Explorer",-1),Yt={class:"value"},Xt=["href"],Kt={class:"prop-box"},Zt=(0,i._)("div",{class:"category"},"ðŸ”’ Bond",-1),Qt={class:"value"},Jt={class:"prop-box"},es=(0,i._)("div",{class:"category"},"Bond providers",-1),ts={class:"value"},ss={class:"prop-box"},ns=(0,i._)("div",{class:"category"},"ðŸ† Awards",-1),is={class:"value"},os={class:"prop-box"},rs=(0,i._)("div",{class:"category"},"ðŸ˜ˆ Slash points",-1),as={class:"value"},cs={class:"category"},ls={class:"value"},hs=["title"],ds={key:0},us={key:1},ms={key:1};function ps(e,t,s,o,r,a){const c=(0,i.up)("font-awesome-icon"),l=(0,i.Q2)("tippy");return(0,i.wg)(),(0,i.j4)(n.uT,{name:"shrink"},{default:(0,i.w5)((()=>[(0,i._)("div",{class:(0,g.C_)({"window window-left":s.isLeft,"window window-right":!s.isLeft}),onKeyup:t[2]||(t[2]=(0,n.D2)((0,n.iM)(((...e)=>a.close&&a.close(...e)),["prevent"]),["esc"])),tabindex:"0",ref:"modal"},[(0,i.wy)((0,i._)("div",{class:"close-button",onClick:t[0]||(t[0]=(...e)=>a.close&&a.close(...e)),content:"Close it"},null,512),[[l]]),wt,(0,i._)("h2",null,[s.node.requestedToLeave?(0,i.wy)(((0,i.wg)(),(0,i.j4)(c,{key:0,class:"icon",icon:"fa-solid fa-arrow-right",content:"Requested to leave!"},null,512)),[[l]]):(0,i.kq)("",!0),s.node.forcedToLeave?(0,i.wy)(((0,i.wg)(),(0,i.j4)(c,{key:1,class:"icon",icon:"fa-solid fa-arrow-down-up-lock",content:"Forced to leave!"},null,512)),[[l]]):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,g.zw)(s.node.address)+" ",1),(0,i.wy)(((0,i.wg)(),(0,i.iD)("button",{class:"copy-button",onClick:t[1]||(t[1]=(...e)=>a.copyNodeAddress&&a.copyNodeAddress(...e)),content:"Copy address"},[(0,i.Wm)(c,{icon:"fa-solid fa-copy"})])),[[l]])]),(0,i._)("div",_t,[(0,i._)("div",bt,[St,(0,i.Uk)(" "+(0,g.zw)(a.statusEmoji)+" ",1),(0,i._)("span",{class:(0,g.C_)(a.nodeStatusClass)},(0,g.zw)(s.node.status),3)]),(0,i._)("div",Pt,[Tt,(0,i._)("div",Ct,[a.isOldest?(0,i.wy)(((0,i.wg)(),(0,i.iD)("span",Nt,[(0,i.Uk)("âŒ›")])),[[l]]):(0,i.kq)("",!0),(0,i.Uk)(" "+(0,g.zw)(a.statusSince)+" ",1),(0,i._)("small",null,"(#"+(0,g.zw)(a.ageRank)+")",1)])]),(0,i._)("div",kt,[Mt,(0,i._)("div",Dt,[a.isUpToDataVersion?(0,i.wy)(((0,i.wg)(),(0,i.iD)("span",At,[(0,i.Uk)("ðŸ‘Œ")])),[[l]]):(0,i.wy)(((0,i.wg)(),(0,i.iD)("span",Vt,[(0,i.Uk)("âš ï¸")])),[[l]]),(0,i.Uk)(" "+(0,g.zw)(s.node.version),1)])]),a.hasIP?((0,i.wg)(),(0,i.iD)("div",Et,[Ot,(0,i._)("div",It,[(0,i._)("a",{href:a.ipAddressInfoLink,target:"_blank"},(0,g.zw)(s.node.IPAddress),9,zt)])])):(0,i.kq)("",!0),a.hasIP?((0,i.wg)(),(0,i.iD)("div",Ft,[Rt,(0,i._)("div",Bt,(0,g.zw)(s.node.IPInfo?.flag)+" "+(0,g.zw)(s.node.IPInfo?.country)+", "+(0,g.zw)(s.node.IPInfo?.city||"unknown city"),1)])):(0,i.kq)("",!0),a.hasIP?((0,i.wg)(),(0,i.iD)("div",jt,[Lt,(0,i._)("div",Ut,(0,g.zw)(a.providerName),1)])):((0,i.wg)(),(0,i.iD)("div",Ht,qt)),(0,i._)("div",Wt,[$t,(0,i._)("div",Yt,[(0,i._)("a",{href:`https://viewblock.io/thorchain/address/${s.node.address}`,target:"_blank"},"Viewblock â€“ "+(0,g.zw)(s.node.shortAddress),9,Xt)])]),(0,i._)("div",Kt,[Zt,(0,i._)("div",Qt,[(0,i.Uk)((0,g.zw)(a.nodeBond)+" ",1),(0,i._)("small",null,"(#"+(0,g.zw)(a.nodeBondRank)+")",1)])]),(0,i._)("div",Jt,[es,(0,i._)("div",ts,(0,g.zw)(s.node.bondProviders?.providers?.length),1)]),(0,i._)("div",ss,[ns,(0,i._)("div",is,(0,g.zw)(a.award),1)]),(0,i._)("div",os,[rs,(0,i._)("div",as,[(0,i.Uk)((0,g.zw)(s.node.slashPoints)+" pts. ",1),(0,i._)("small",null,"(#"+(0,g.zw)(a.slashPointsRank)+")",1)])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.chainEntries,(([e,t])=>((0,i.wg)(),(0,i.iD)("div",{class:"prop-box",key:e},[(0,i._)("div",cs,(0,g.zw)(e),1),(0,i._)("div",ls,[a.chainLag(e)?((0,i.wg)(),(0,i.iD)("span",{key:0,title:t,class:"chain-lag"},[(0,i.Uk)(" ðŸ©¸ "),t>0?((0,i.wg)(),(0,i.iD)("span",ds,(0,g.zw)(a.chainLag(e))+" blocks behind! ",1)):((0,i.wg)(),(0,i.iD)("span",us," No sync at all "))],8,hs)):((0,i.wg)(),(0,i.iD)("span",ms," Up to date "))])])))),128))])],34)])),_:1})}var vs=s(1945),fs=s.n(vs);const gs={[ae.Active]:{emoji:"âœ…",class:"status-active"},[ae.Standby]:{emoji:"â³",class:"status-standby"},[ae.Disabled]:{emoji:"ðŸ”´",class:"status-disabled"},[ae.Whitelisted]:{emoji:"ðŸ“„",class:"status-whitelisted"}};var ys={name:"NodeDetailsWindow",emits:["close"],props:["node","nodeSet","isLeft"],data(){return{}},computed:{chainEntries(){const e=Object.keys(this.nodeSet.topHeights);return e.sort(),I().map(e,(e=>[e,this.node.observeChains[e]??0]))},topThorHeight(){return ot.lastBlock.THOR},hasIP(){return this.node.IPAddress&&""!==this.node.IPAddress},statusEmoji(){return gs[this.node.status]?.emoji},nodeStatusClass(){return gs[this.node.status]?.class},statusSince(){const e=this.nodeSet.estimateTimestampAtBlock(this.topThorHeight,this.node.statusSince);try{return new Date(e).toISOString().slice(0,10)}catch{return"N/A"}},isOldest(){return!0},ageRank(){return this.nodeSet.ranks.age[this.node.address]},award(){return q(Math.round(this.node.currentAward))},nodeBond(){return q(Math.round(this.node.bond))},nodeBondRank(){return this.nodeSet.ranks.bond[this.node.address]},nodeBondPercent(){return this.nodeSet.bondPercentOfTotal(this.node.bond)},ipAddressInfoLink(){return`https://www.infobyip.com/ip-${this.node.IPAddress}.html`},slashPointsRank(){return this.nodeSet.ranks.slash[this.node.address]},chainLag(){return e=>this.nodeSet.getChainHeightLagBlocks(this.node,e)},providerName(){const e=this.node?.IPInfo?.providerName??Be;return je.refineProviderName(e)},isUpToDataVersion(){return this.node.version===this.nodeSet.topVersion}},methods:{copyNodeAddress(){fs()(this.node.address)},close(){this.$emit("close")}},mounted(){this.$refs.modal.focus()}};const xs=(0,A.Z)(ys,[["render",ps]]);var ws=xs,_s=s(8657);class bs{constructor(e,t=new h.Vector3){this.domElement=e,this.center=t,this._createCamera(),this._createCameraControl(),this._animating=!1,this.controlsEnabled=!0}reset(){this.controls.reset()}projectToScreen(e){return this.camera.updateProjectionMatrix(),e.project(this.camera)}_createCamera(){this.camera=new h.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.001,2*u.Controls.Camera.Distance.Max),this.camera.position.z=u.Controls.Camera.Distance.Start}_createCameraControl(){const e=this.controls=new _s.Z(this.camera,this.domElement),t=u.Controls.Camera;e.dragToOffset=!0,e.minDistance=t.Distance.Min,e.maxDistance=t.Distance.Max,this.camera.position.z=t.Distance.Start,e.minAzimuthAngle=h.MathUtils.degToRad(-t.AzimuthAngleLimit),e.maxAzimuthAngle=h.MathUtils.degToRad(t.AzimuthAngleLimit),e.minPolarAngle=h.MathUtils.degToRad(90-t.PolarAngleLimit),e.maxPolarAngle=h.MathUtils.degToRad(t.PolarAngleLimit+90),e.update(0)}update(e){!this.controlsEnabled||this._animating||this.cameraInspectsObject||this.controls.update(e)}onResize(){const e=this.domElement,t=e.clientWidth,s=e.clientHeight;this.camera.aspect=t/s,this.camera.updateProjectionMatrix()}_getEndQuaternion(e,t){const s=this.camera.position.clone(),n=this.camera.quaternion.clone();this.camera.position.copy(e),this.camera.lookAt(t);const i=this.camera.quaternion.clone();return this.camera.position.copy(s),this.camera.quaternion.copy(n),i}cameraLookAtNode(e,t){this.cameraInspectsObject||(this.oldCameraPos=this.camera.position.clone(),this.oldCameraQuaternion=this.camera.quaternion.clone(),this.cameraInspectsObject=!0),this._animating=!0;const s=u.Controls.Camera.Animation,n=this;let i,o;if(t)i=e.o.position.clone().add(new h.Vector3(0,0,s.DistanceWhenZoomed)),o=e.o.position.clone();else{const t=e.o.position.clone().normalize().multiplyScalar(s.DistanceWhenZoomed);i=e.o.position.clone().add(t),o=e.o.position.clone()}new(le().Tween)(this.camera.position).to(i,s.Duration).easing(le().Easing.Sinusoidal.InOut).onComplete((()=>{n._animating=!1})).start();const r=this._getEndQuaternion(i,o);new(le().Tween)(this.camera.quaternion).to(r,s.Duration).easing(le().Easing.Sinusoidal.InOut).start()}restoreCamera(){if(this.cameraInspectsObject){this.cameraInspectsObject=!1,this._animating=!0;const e=this,t=u.Controls.Camera.Animation.Duration;new(le().Tween)(this.camera.position).to(this.oldCameraPos,u.Controls.Camera.Animation.Duration).easing(le().Easing.Sinusoidal.InOut).onUpdate((function(){})).onComplete((()=>{e._animating=!1})).start();const s=this._getEndQuaternion(this.oldCameraPos,this.center);new(le().Tween)(this.camera.quaternion).to(s,t).easing(le().Easing.Sinusoidal.InOut).start()}}dispose(){this.controls.dispose()}}const Ss={class:"loading-indicator"};function Ps(e,t,s,n,o,r){return(0,i.wg)(),(0,i.iD)("div",Ss,[(0,i.Uk)("Loading."),(0,i._)("span",null,(0,g.zw)(o.dots),1)])}var Ts={name:"LoadingIndicator",data(){return{dots:""}},methods:{tick(){this.dots+=".",this.dots.length>=3&&(this.dots="")}},mounted(){this.timer=setInterval(this.tick,200)},beforeUnmount(){clearInterval(this.timer)}};const Cs=(0,A.Z)(Ts,[["render",Ps],["__scopeId","data-v-3618bf7b"]]);var Ns=Cs,ks=s(4870);class Ms extends h.Object3D{constructor(e,t){super(),this.orientToMovement=!!t,this.scene=e,this.geometry=null,this.mesh=null,this.nodeCenters=null,this.lastNodeCenter=null,this.currentNodeCenter=null,this.lastOrientationDir=null,this.nodeIDs=null,this.currentLength=0,this.currentEnd=0,this.currentNodeID=0}}Ms.MaxHeadVertices=128,Ms.LocalOrientationTangent=new h.Vector3(1,0,0),Ms.LocalOrientationDirection=new h.Vector3(0,0,-1),Ms.LocalHeadOrigin=new h.Vector3(0,0,0),Ms.PositionComponentCount=3,Ms.UVComponentCount=2,Ms.IndicesPerFace=3,Ms.FacesPerQuad=2,Ms.Shader={},Ms.Shader.BaseVertexVars=["attribute float nodeID;","attribute float nodeVertexID;","attribute vec3 nodeCenter;","uniform float minID;","uniform float maxID;","uniform float trailLength;","uniform float maxTrailLength;","uniform float verticesPerNode;","uniform vec2 textureTileFactor;","uniform vec4 headColor;","uniform vec4 tailColor;","varying vec4 vColor;"].join("\n"),Ms.Shader.TexturedVertexVars=[Ms.Shader.BaseVertexVars,"varying vec2 vUV;","uniform float dragTexture;"].join("\n"),Ms.Shader.BaseFragmentVars=["varying vec4 vColor;","uniform sampler2D texture;"].join("\n"),Ms.Shader.TexturedFragmentVars=[Ms.Shader.BaseFragmentVars,"varying vec2 vUV;"].join("\n"),Ms.Shader.VertexShaderCore=["float fraction = ( maxID - nodeID ) / ( maxID - minID );","vColor = ( 1.0 - fraction ) * headColor + fraction * tailColor;","vec4 realPosition = vec4( ( 1.0 - fraction ) * position.xyz + fraction * nodeCenter.xyz, 1.0 ); "].join("\n"),Ms.Shader.BaseVertexShader=[Ms.Shader.BaseVertexVars,"void main() { ",Ms.Shader.VertexShaderCore,"gl_Position = projectionMatrix * viewMatrix * realPosition;","}"].join("\n"),Ms.Shader.BaseFragmentShader=[Ms.Shader.BaseFragmentVars,"void main() { ","gl_FragColor = vColor;","}"].join("\n"),Ms.Shader.TexturedVertexShader=[Ms.Shader.TexturedVertexVars,"void main() { ",Ms.Shader.VertexShaderCore,"float s = 0.0;","float t = 0.0;","if ( dragTexture == 1.0 ) { ","   s = fraction *  textureTileFactor.s; "," \tt = ( nodeVertexID / verticesPerNode ) * textureTileFactor.t;","} else { ","\ts = nodeID / maxTrailLength * textureTileFactor.s;"," \tt = ( nodeVertexID / verticesPerNode ) * textureTileFactor.t;","}","vUV = vec2( s, t ); ","gl_Position = projectionMatrix * viewMatrix * realPosition;","}"].join("\n"),Ms.Shader.TexturedFragmentShader=[Ms.Shader.TexturedFragmentVars,"void main() { ","vec4 textureColor = texture2D( texture, vUV );","gl_FragColor = vColor * textureColor;","}"].join("\n"),Ms.createMaterial=function(e,t,s){return s=s||{},s.trailLength={type:"f",value:null},s.verticesPerNode={type:"f",value:null},s.minID={type:"f",value:null},s.maxID={type:"f",value:null},s.dragTexture={type:"f",value:null},s.maxTrailLength={type:"f",value:null},s.textureTileFactor={type:"v2",value:null},s.headColor={type:"v4",value:new h.Vector4},s.tailColor={type:"v4",value:new h.Vector4},e=e||Ms.Shader.BaseVertexShader,t=t||Ms.Shader.BaseFragmentShader,new h.ShaderMaterial({uniforms:s,vertexShader:e,fragmentShader:t,transparent:!0,alphaTest:.5,blending:h.CustomBlending,blendSrc:h.SrcAlphaFactor,blendDst:h.OneMinusSrcAlphaFactor,blendEquation:h.AddEquation,depthTest:!0,depthWrite:!1,side:h.DoubleSide})},Ms.createBaseMaterial=function(e){return this.createMaterial(Ms.Shader.BaseVertexShader,Ms.Shader.BaseFragmentShader,e)},Ms.createTexturedMaterial=function(e){return e={},e.texture={type:"t",value:null},this.createMaterial(Ms.Shader.TexturedVertexShader,Ms.Shader.TexturedFragmentShader,e)},Ms.prototype.initialize=function(e,t,s,n,i,o){this.deactivate(),this.destroyMesh(),this.length=t>0?t+1:0,this.dragTexture=s?1:0,this.targetObject=o,this.initializeLocalHeadGeometry(n,i),this.nodeIDs=[],this.nodeCenters=[];for(var r=0;r<this.length;r++)this.nodeIDs[r]=-1,this.nodeCenters[r]=new h.Vector3;this.material=e,this.initializeGeometry(),this.initializeMesh(),this.material.uniforms.trailLength.value=0,this.material.uniforms.minID.value=0,this.material.uniforms.maxID.value=0,this.material.uniforms.dragTexture.value=this.dragTexture,this.material.uniforms.maxTrailLength.value=this.length,this.material.uniforms.verticesPerNode.value=this.VerticesPerNode,this.material.uniforms.textureTileFactor.value=new h.Vector2(1,1),this.reset()},Ms.prototype.initializeLocalHeadGeometry=function(e,t){if(this.localHeadGeometry=[],t){this.VerticesPerNode=0;for(var s=0;s<t.length&&s<Ms.MaxHeadVertices;s++){var n=t[s];if(n&&n instanceof h.Vector3){var i=new h.Vector3;i.copy(n),this.localHeadGeometry.push(i),this.VerticesPerNode++}}}else{var o=e||1;o/=2,this.localHeadGeometry.push(new h.Vector3(-o,0,0)),this.localHeadGeometry.push(new h.Vector3(o,0,0)),this.VerticesPerNode=2}this.FacesPerNode=2*(this.VerticesPerNode-1),this.FaceIndicesPerNode=3*this.FacesPerNode},Ms.prototype.initializeGeometry=function(){this.vertexCount=this.length*this.VerticesPerNode,this.faceCount=this.length*this.FacesPerNode;var e=new h.BufferGeometry,t=new Float32Array(this.vertexCount),s=new Float32Array(this.vertexCount*this.VerticesPerNode),n=new Float32Array(this.vertexCount*Ms.PositionComponentCount),i=new Float32Array(this.vertexCount*Ms.PositionComponentCount),o=new Float32Array(this.vertexCount*Ms.UVComponentCount),r=new Uint32Array(this.faceCount*Ms.IndicesPerFace),a=new h.BufferAttribute(t,1);a.setUsage(h.DynamicDrawUsage),e.setAttribute("nodeID",a);var c=new h.BufferAttribute(s,1);c.setUsage(h.DynamicDrawUsage),e.setAttribute("nodeVertexID",c);var l=new h.BufferAttribute(i,Ms.PositionComponentCount);l.setUsage(h.DynamicDrawUsage),e.setAttribute("nodeCenter",l);var d=new h.BufferAttribute(n,Ms.PositionComponentCount);d.setUsage(h.DynamicDrawUsage),e.setAttribute("position",d);var u=new h.BufferAttribute(o,Ms.UVComponentCount);u.setUsage(h.DynamicDrawUsage),e.setAttribute("uv",u);var m=new h.BufferAttribute(r,1);m.setUsage(h.DynamicDrawUsage),e.setIndex(m),this.geometry=e},Ms.prototype.zeroVertices=function(){for(var e=this.geometry.getAttribute("position"),t=0;t<this.vertexCount;t++){var s=3*t;e.array[s]=0,e.array[s+1]=0,e.array[s+2]=0}e.needsUpdate=!0,e.updateRange.count=-1},Ms.prototype.zeroIndices=function(){for(var e=this.geometry.getIndex(),t=0;t<this.faceCount;t++){var s=3*t;e.array[s]=0,e.array[s+1]=0,e.array[s+2]=0}e.needsUpdate=!0,e.updateRange.count=-1},Ms.prototype.formInitialFaces=function(){this.zeroIndices();for(var e=this.geometry.getIndex(),t=0;t<this.length-1;t++)this.connectNodes(t,t+1);e.needsUpdate=!0,e.updateRange.count=-1},Ms.prototype.initializeMesh=function(){this.mesh=new h.Mesh(this.geometry,this.material),this.mesh.dynamic=!0,this.mesh.matrixAutoUpdate=!1},Ms.prototype.destroyMesh=function(){this.mesh&&(this.scene.remove(this.mesh),this.mesh=null)},Ms.prototype.reset=function(){this.currentLength=0,this.currentEnd=-1,this.lastNodeCenter=null,this.currentNodeCenter=null,this.lastOrientationDir=null,this.currentNodeID=0,this.formInitialFaces(),this.zeroVertices(),this.geometry.setDrawRange(0,0)},Ms.prototype.updateUniforms=function(){this.currentLength<this.length?this.material.uniforms.minID.value=0:this.material.uniforms.minID.value=this.currentNodeID-this.length,this.material.uniforms.maxID.value=this.currentNodeID,this.material.uniforms.trailLength.value=this.currentLength,this.material.uniforms.maxTrailLength.value=this.length,this.material.uniforms.verticesPerNode.value=this.VerticesPerNode},Ms.prototype.advance=function(){var e=new h.Matrix4;return function(){this.targetObject.updateMatrixWorld(),e.copy(this.targetObject.matrixWorld),this.advanceWithTransform(e),this.updateUniforms()}}(),Ms.prototype.advanceWithPositionAndOrientation=function(e,t){this.advanceGeometry({position:e,tangent:t},null)},Ms.prototype.advanceWithTransform=function(e){this.advanceGeometry(null,e)},Ms.prototype.advanceGeometry=function(){return function(e,t){var s=this.currentEnd+1>=this.length?0:this.currentEnd+1;if(t?this.updateNodePositionsFromTransformMatrix(s,t):this.updateNodePositionsFromOrientationTangent(s,e.position,e.tangent),this.currentLength>=1&&(this.connectNodes(this.currentEnd,s),this.currentLength>=this.length)){var n=this.currentEnd+1>=this.length?0:this.currentEnd+1;this.disconnectNodes(n)}this.currentLength<this.length&&this.currentLength++,this.currentEnd++,this.currentEnd>=this.length&&(this.currentEnd=0),this.currentLength>=1&&(this.currentLength<this.length?this.geometry.setDrawRange(0,(this.currentLength-1)*this.FaceIndicesPerNode):this.geometry.setDrawRange(0,this.currentLength*this.FaceIndicesPerNode)),this.updateNodeID(this.currentEnd,this.currentNodeID),this.currentNodeID++}}(),Ms.prototype.updateHead=function(){var e=new h.Matrix4;return function(){this.currentEnd<0||(this.targetObject.updateMatrixWorld(),e.copy(this.targetObject.matrixWorld),this.updateNodePositionsFromTransformMatrix(this.currentEnd,e))}}(),Ms.prototype.updateNodeID=function(e,t){this.nodeIDs[e]=t;for(var s=this.geometry.getAttribute("nodeID"),n=this.geometry.getAttribute("nodeVertexID"),i=0;i<this.VerticesPerNode;i++){var o=e*this.VerticesPerNode+i;s.array[o]=t,n.array[o]=i}s.needsUpdate=!0,n.needsUpdate=!0,s.updateRange.offset=e*this.VerticesPerNode,s.updateRange.count=this.VerticesPerNode,n.updateRange.offset=e*this.VerticesPerNode,n.updateRange.count=this.VerticesPerNode},Ms.prototype.updateNodeCenter=function(e,t){this.lastNodeCenter=this.currentNodeCenter,this.currentNodeCenter=this.nodeCenters[e],this.currentNodeCenter.copy(t);for(var s=this.geometry.getAttribute("nodeCenter"),n=0;n<this.VerticesPerNode;n++){var i=3*(e*this.VerticesPerNode+n);s.array[i]=t.x,s.array[i+1]=t.y,s.array[i+2]=t.z}s.needsUpdate=!0,s.updateRange.offset=e*this.VerticesPerNode*Ms.PositionComponentCount,s.updateRange.count=this.VerticesPerNode*Ms.PositionComponentCount},Ms.prototype.updateNodePositionsFromOrientationTangent=function(){for(var e=new h.Quaternion,t=new h.Vector3,s=[],n=0;n<Ms.MaxHeadVertices;n++){var i=new h.Vector3;s.push(i)}return function(n,i,o){var r=this.geometry.getAttribute("position");this.updateNodeCenter(n,i),t.copy(i),t.sub(Ms.LocalHeadOrigin),e.setFromUnitVectors(Ms.LocalOrientationTangent,o);for(var a=0;a<this.localHeadGeometry.length;a++){var c=s[a];c.copy(this.localHeadGeometry[a]),c.applyQuaternion(e),c.add(t)}for(a=0;a<this.localHeadGeometry.length;a++){var l=(this.VerticesPerNode*n+a)*Ms.PositionComponentCount,h=s[a];r.array[l]=h.x,r.array[l+1]=h.y,r.array[l+2]=h.z}r.needsUpdate=!0}}(),Ms.prototype.updateNodePositionsFromTransformMatrix=function(){for(var e=new h.Matrix3,t=new h.Quaternion,s=new h.Vector3,n=new h.Vector3,i=new h.Vector3,o=new h.Vector3,r=[],a=0;a<Ms.MaxHeadVertices;a++){var c=new h.Vector3;r.push(c)}function l(e,t){var s=t.elements;e.set(s[0],s[1],s[2],s[4],s[5],s[6],s[8],s[9],s[10])}return function(a,c){var d,u=this.geometry.getAttribute("position");s.set(0,0,0),s.applyMatrix4(c),this.updateNodeCenter(a,s);for(var m=0;m<this.localHeadGeometry.length;m++)d=r[m],d.copy(this.localHeadGeometry[m]);for(m=0;m<this.localHeadGeometry.length;m++)d=r[m],d.applyMatrix4(c);if(this.lastNodeCenter&&this.orientToMovement&&(l(e,c),i.set(0,0,-1),i.applyMatrix3(e),o.copy(this.currentNodeCenter),o.sub(this.lastNodeCenter),o.normalize(),o.lengthSq()<=1e-4&&this.lastOrientationDir&&o.copy(this.lastOrientationDir),o.lengthSq()>1e-4))for(this.lastOrientationDir||(this.lastOrientationDir=new h.Vector3),t.setFromUnitVectors(i,o),n.copy(this.currentNodeCenter),m=0;m<this.localHeadGeometry.length;m++)d=r[m],d.sub(n),d.applyQuaternion(t),d.add(n);for(m=0;m<this.localHeadGeometry.length;m++){var p=(this.VerticesPerNode*a+m)*Ms.PositionComponentCount,v=r[m];u.array[p]=v.x,u.array[p+1]=v.y,u.array[p+2]=v.z}u.needsUpdate=!0,u.updateRange.offset=a*this.VerticesPerNode*Ms.PositionComponentCount,u.updateRange.count=this.VerticesPerNode*Ms.PositionComponentCount}}(),Ms.prototype.connectNodes=function(){var e={attribute:null,offset:0,count:-1};return function(t,s){for(var n=this.geometry.getIndex(),i=0;i<this.localHeadGeometry.length-1;i++){var o=this.VerticesPerNode*t+i,r=this.VerticesPerNode*s+i,a=(t*this.FacesPerNode+i*Ms.FacesPerQuad)*Ms.IndicesPerFace;n.array[a]=o,n.array[a+1]=r,n.array[a+2]=o+1,n.array[a+3]=r,n.array[a+4]=r+1,n.array[a+5]=o+1}return n.needsUpdate=!0,n.updateRange.count=-1,e.attribute=n,e.offset=t*this.FacesPerNode*Ms.IndicesPerFace,e.count=this.FacesPerNode*Ms.IndicesPerFace,e}}(),Ms.prototype.disconnectNodes=function(){var e={attribute:null,offset:0,count:-1};return function(t){for(var s=this.geometry.getIndex(),n=0;n<this.localHeadGeometry.length-1;n++){var i=(t*this.FacesPerNode+n*Ms.FacesPerQuad)*Ms.IndicesPerFace;s.array[i]=0,s.array[i+1]=0,s.array[i+2]=0,s.array[i+3]=0,s.array[i+4]=0,s.array[i+5]=0}return s.needsUpdate=!0,s.updateRange.count=-1,e.attribute=s,e.offset=t*this.FacesPerNode*Ms.IndicesPerFace,e.count=this.FacesPerNode*Ms.IndicesPerFace,e}}(),Ms.prototype.deactivate=function(){this.isActive&&(this.scene.remove(this.mesh),this.isActive=!1)},Ms.prototype.activate=function(){this.isActive||(this.scene.add(this.mesh),this.isActive=!0)};class Ds{constructor(e){this.scene=e,this.baseTrailMaterial=Ms.createBaseMaterial(),this.material=this.baseTrailMaterial,this.material.depthWrite=!1,this.circlePoints=this.makeCircle(),this.makeTrailTarget(this.circlePoints),this.makeTrail(),this._makeFlyState()}makeTrail(){const e=300;this.trail=new Ms(this.scene,!1),this.trail.initialize(this.material,Math.floor(e),0,0,this.circlePoints,this.trailTarget),this.updateColors(new h.Color(m.LightningBlue),new h.Color(m.YggdrasilGreen)),this.trail.activate()}updateColors(e,t){this.material.uniforms.headColor.value.copy(e),this.material.uniforms.tailColor.value.copy(t)}_makeFlyState(){this.lastTrailUpdateTime=0,this._t=0,this.lastDirection=new h.Vector3,this.lastTargetPosition=new h.Vector3,this.lastRotationMatrix=new h.Matrix4,this.currentTargetPosition=new h.Vector3,this.currentDirection=new h.Vector3,this.tempQuaternion=new h.Quaternion,this.baseForward=new h.Vector3(0,0,-1),this.tempUp=new h.Vector3,this.tempRotationMatrix=new h.Matrix4,this.tempTranslationMatrix=new h.Matrix4}update(e){if(e<=0)return;this._t+=e;const t=100,s=1e4;this._t-this.lastTrailUpdateTime>s?(this.trail.advance(),this.lastTrailUpdateTime=this._t):this.trail.updateHead();const n=this._t;this.lastTargetPosition.copy(this.currentTargetPosition),this.currentTargetPosition.x=Math.sin(n)*t,this.currentTargetPosition.y=Math.sin(1.1*n)*t,this.currentTargetPosition.z=Math.sin(1.6*n)*t,this.lastDirection.copy(this.currentDirection),this.currentDirection.copy(this.currentTargetPosition),this.currentDirection.sub(this.lastTargetPosition),this.currentDirection.normalize(),this.tempUp.crossVectors(this.currentDirection,this.baseForward),this.tempRotationMatrix.identity();const i=this.baseForward.angleTo(this.currentDirection);Math.abs(i)>.01&&this.tempUp.lengthSq()>.001&&(this.tempQuaternion.setFromUnitVectors(this.baseForward,this.currentDirection),this.tempQuaternion.normalize(),this.tempRotationMatrix.makeRotationFromQuaternion(this.tempQuaternion),this.lastRotationMatrix.copy(this.tempRotationMatrix)),this.tempTranslationMatrix.identity(),this.tempTranslationMatrix.makeTranslation(this.currentTargetPosition.x,this.currentTargetPosition.y,this.currentTargetPosition.z),this.tempRotationMatrix.multiply(this.tempTranslationMatrix),this.trailTarget.matrix.identity(),this.trailTarget.applyMatrix4(this.tempRotationMatrix),this.trailTarget.updateMatrixWorld()}makeCircle(){let e=[];const t=2*Math.PI;let s=0;const n=10,i=t/32;for(let o=0;o<=t+i;o+=i)e[s]=new h.Vector3(Math.cos(o)*n,Math.sin(o)*n,0),s++;return e}makeTrailTarget(e){const t=new h.Shape(e),s={depth:2,size:2,height:1,curveSegments:3,bevelThickness:1,bevelSize:2,bevelEnabled:!1,material:0,extrudeMaterial:1},n=new h.ExtrudeGeometry(t,s),i=new h.MeshPhongMaterial({color:10530223,shininess:10,specular:1118481,flatShading:!1}),o=this.trailTarget=new h.Mesh(n,i);o.receiveShadow=!1,this.scene.add(o)}}class As{constructor(e,t){this.scene=e,this.cameraController=t,this._makeSomeLight(),this.trailTester=new Ds(this.scene),M()}_makeSomeLight(){const e=new h.AmbientLight(4210752);this.scene.add(e)}update(e){this.trailTester.update(e)}dispose(){b(this.scene)}}class Vs{constructor(e,t){this.scene=e,this.camera=t,this._makeSomeLight(),M(),this.nodeObj=new ge(new re({node_address:"thor123",status:"Active",bond:1e17,version:"1.96.2"})),this.nodeObj.labelObj.visible=!1,this.nodeObj.material.uniforms.rust.value=-1,new(le().Tween)(this.nodeObj.material.uniforms.rust).to({value:1},2e3).repeat(1/0).yoyo(!0).start(),this.nodeObj.o.position.set(0,0,1500),e.add(this.nodeObj.o),this.camera.zoom=100}_makeSomeLight(){const e=new h.AmbientLight(16777215);this.scene.add(e)}update(e){this.nodeObj.update(.1*e)}dispose(){b(this.scene)}}class Es{constructor(e,t=6e4,s="/version.txt"){this.bus=e,this._timer=0,this._checkInterval=t,this._url=s,this._version=""}get isRunning(){return 0!==this._timer}run(){this.isRunning||(this._tick().then(),this._timer=setInterval(this._tick.bind(this),this._checkInterval))}stop(){this.isRunning&&(clearInterval(this._timer),this._timer=0)}async _tick(){const e=await Ie().get(this._url);if(200===e.status){const t=e.data.trim();if(""===this._version)this._version=t,console.log(`Set current version: ${this._version}`);else if(this._version!==t){const e=this._version;this._version=t,this._notify(this._version,e)}}else console.error(`Failed to fetch version file. Status: ${e.status}.`)}_notify(e,t){console.info(`New software version detected: ${t} => ${e}`),this.bus.emit(C.NewViewerVersion,{newVersion:e,oldVersion:t})}}const Os=e=>((0,i.dD)("data-v-2a579dc4"),e=e(),(0,i.Cn)(),e),Is={class:"panel"},zs=Os((()=>(0,i._)("div",null,"New version is available",-1))),Fs={class:"details"},Rs={class:"old-version"},Bs={class:"new-version"};function js(e,t,s,n,o,r){const a=(0,i.up)("font-awesome-icon");return(0,i.wg)(),(0,i.iD)("div",Is,[zs,(0,i._)("div",Fs,[(0,i._)("span",Rs,(0,g.zw)(s.oldVersion),1),(0,i.Wm)(a,{icon:"fa-solid fa-arrow-right"}),(0,i._)("span",Bs,(0,g.zw)(s.newVersion),1),(0,i._)("button",{onClick:t[0]||(t[0]=(...e)=>r.reload&&r.reload(...e)),class:"reload-button"},[(0,i.Uk)(" Reload the page "),(0,i.Wm)(a,{icon:"fa-solid fa-rotate-right"})])])])}var Ls={name:"NewVersionPanel",props:["newVersion","oldVersion"],data(){return{}},methods:{reload(){document.location.reload(!0)}},mounted(){},beforeUnmount(){}};const Us=(0,A.Z)(Ls,[["render",js],["__scopeId","data-v-2a579dc4"]]);var Hs=Us,Gs={name:"MainScreen",components:{NewVersionPanel:Hs,LoadingIndicator:Ns,NodeDetailsWindow:ws,ControlPanel:xt,FPSCounter:E},props:{},data(){return{isLoading:!0,showFps:u.Debug.ShowFPS,mouseEnterX:0,mouseEnterY:0,tickCounter:0,sceneMode:"normal",fullyLoaded:!1,nodeDetailsVisible:!1,nodeDetailsIsLeft:!0,nodeToViewDetails:new re,zoomedToNode:!1,nodeSet:(0,ks.XI)(),version:{newDetected:!1,oldVersion:"1",newVersion:"2"}}},methods:{onKeyDown(e){"KeyR"===e.code?this.cameraController.reset():"KeyF"===e.code?this.showFps=!this.showFps:"KeyH"===e.code&&console.log("help?")},choseWindowSide(e){this.nodeDetailsIsLeft=!(e.clientX<.5*window.innerWidth)},onMouseMove(e){const t=e.clientX,s=e.clientY;if(!this.mouseEnterX)return this.mouseEnterX=t,void(this.mouseEnterY=s);const n=u.Controls.Camera.MouseMoveStrength,i=this.mouseEnterX-t,o=this.mouseEnterY-s;this.mouseEnterX=t,this.mouseEnterY=s,this.cameraController.controls.rotate(i*n,o*n);const r=this._pickObject(e);let a="";r?(a=r?.object?.name,this.content.nodeGroup.setElevatedNode(a),this.choseWindowSide(e),this.zoomedToNode||(this.nodeDetailsVisible=!!a,this.nodeDetailsVisible&&(this.nodeToViewDetails=this.content.findNodeByAddress(a)))):this.zoomedToNode||(this.nodeDetailsVisible=!1),this.content.nodeGroup.setElevatedNode(a)},onMouseEnter(e){this.mouseEnterX=e.clientX,this.mouseEnterY=e.clientY},onMouseLeave(){},_pickObject(e,t=!1){if(!this.raycaster||!this.content.nodeGroup)return null;const s=this.getCanvasRelativePosition(e);this.raycaster.setFromCamera(s,this.cameraController.camera);const n=this.raycaster.intersectObjects(this.content.nodeGroup.holder.children,!0);t&&console.log("Objects hit by the ray caster: "+n.length);const i=I().filter(n,(e=>e.object.name&&""!==e.object.name));return i.length?i[0]:null},onClick(e){const t=this._pickObject(e,!0);if(t&&t.object){const s=t.object.name;s&&s.startsWith("thor")&&(this.choseWindowSide(e),this._onPickNodeObject(s))}else this.nodeDetailsVisible=!1,this.zoomedToNode=!1,this.cameraController.restoreCamera()},_onPickNodeObject(e){console.log("Picked node:",e),this.content.pick(e),this.nodeToViewDetails=this.content.findNodeByAddress(e),this.nodeDetailsVisible=!0;const t=this.content.nodeGroup.getByName(e);t&&(this.zoomedToNode=!0,this.cameraController.cameraLookAtNode(t,this.content.nodeGroup.isCurrentModeFlat))},getCanvasRelativePosition(e){const t=this.canvas.getBoundingClientRect(),s={x:e.clientX-t.left,y:e.clientY-t.top};return{x:s.x/this.canvas.clientWidth*2-1,y:-s.y/this.canvas.clientHeight*2+1}},resizeRendererToDisplaySize(){const e=this.renderer,t=e.domElement,s=t.clientWidth,n=t.clientHeight,i=this.composer._width!==s||this.composer._height!==n;return i&&(e.setSize(s,n,!1),this.bloomPass&&this.bloomPass.setSize(s,n),this.composer.setSize(s,n),this.bg&&this.bg.setSize(s,n),this.cameraController.onResize()),i},render(){let e=this.clock.getDelta();"hidden"!==document.visibilityState&&(e>.4&&(e=.01),this.resizeRendererToDisplaySize(this.renderer),le().update(),this.$refs.fps&&this.$refs.fps.update(e,this.scene),this.cameraController.update(e),this.content.update(e),this.bg&&this.bg.update(e),this.composer.render(e),requestAnimationFrame(this.render))},makeSkybox(){u.Scene.Background.Enabled&&(this.bg=new mt(this.scene),this.bg.install())},makeRenderer(e){let t=this.renderer=new h.WebGLRenderer({canvas:e,antialias:!1,logarithmicDepthBuffer:u.Renderer.LogZBuffer});devicePixelRatio&&(console.log(`Renderer: Setting devicePixelRatio = ${devicePixelRatio}.`),t.setPixelRatio(devicePixelRatio));const s=new v.C(this.scene,this.cameraController.camera);this.composer=new p.xC(t),this.composer.addPass(s);const n=u.Effects.Bloom;n.Enabled&&(this.bloomPass=new f.m(new h.Vector2(window.innerWidth,window.innerHeight),n.Strength,n.Radius,n.Threshold),this.composer.addPass(this.bloomPass))},buildScene(){this.scene.add(this.cameraController.camera),this.makeSkybox();const e=u.Scene.DebugMode;this.content="nodeobj"===e?new Vs(this.scene,this.cameraController.camera):"trail"===e?new As(this.scene,this.cameraController.camera):new rt(this.scene,this.cameraController.camera)},setSceneMode(e){this.sceneMode=e,this.content.nodeGroup&&(this.content.nodeGroup.mode=e)},onFullyLoaded(){console.log("fully loaded! removing loading screen..."),this.isLoading=!1,this.fullyLoaded=!0},onDataArrived(e){this.nodeSet=e},onCloseDetails(){this.zoomedToNode=!1,this.nodeDetailsVisible=!1,this.nodeToViewDetails=new re,this.cameraController.restoreCamera()},onNewVersion(e){this.version.newDetected=!0,this.version.oldVersion=e.oldVersion,this.version.newVersion=e.newVersion}},mounted(){this.canvas=this.$refs.canvas,this.clock=new h.Clock,this.scene=new h.Scene,this.cameraController=new bs(this.canvas),this.makeRenderer(this.canvas),this.resizeRendererToDisplaySize(),this.buildScene(),this.raycaster=new h.Raycaster,this.versionTracker=new Es(N,u.SoftwareVersion.Interval),u.SoftwareVersion.Enabled&&this.versionTracker.run(),N.on(C.FullyLoaded,this.onFullyLoaded),N.on(C.DataSourceTick,this.onDataArrived),N.on(C.NewViewerVersion,this.onNewVersion),requestAnimationFrame(this.render)},unmounted(){this.versionTracker.stop(),this.content.dispose(),this.cameraController.dispose(),N.off(C.FullyLoaded),N.off(C.DataSourceTick)}};const qs=(0,A.Z)(Gs,[["render",l]]);var Ws=qs,$s={name:"App",components:{MainScreen:Ws},data(){return{}},computed:{},created(){document.title="THORViz",this.preloading()},methods:{preloading(){(0,$.C5)({font:u.Font.Main,characters:"abcdefghijklmnopqrstuvwxyz1234567890"},(()=>{console.log("font loading done")}))}}};const Ys=(0,A.Z)($s,[["render",o]]);var Xs=Ys,Ks=s(3494),Zs=s(7749),Qs=s(8539),Js=s(814),en=(s(6718),s(3016),s(761));(0,en.W8)()||alert("WebGL is not supported!"),_s.Z.install({THREE:h}),Ks.vI.add(Qs.kZ_,Qs.eFW,Qs.NC7,Qs.mHK);const tn=(0,n.ri)(Xs);tn.component("font-awesome-icon",Zs.GN),tn.use(Js.BA,{directive:"tippy",component:"tippy",flipDuration:0,defaultProps:{placement:"top"},popperOptions:{modifiers:{preventOverflow:{enabled:!1}}}}),tn.config.globalProperties.emitter=N,tn.mount("#app")}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=e,function(){var e=[];s.O=function(t,n,i,o){if(!n){var r=1/0;for(h=0;h<e.length;h++){n=e[h][0],i=e[h][1],o=e[h][2];for(var a=!0,c=0;c<n.length;c++)(!1&o||r>=o)&&Object.keys(s.O).every((function(e){return s.O[e](n[c])}))?n.splice(c--,1):(a=!1,o<r&&(r=o));if(a){e.splice(h--,1);var l=i();void 0!==l&&(t=l)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[n,i,o]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,o,r=n[0],a=n[1],c=n[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(i in a)s.o(a,i)&&(s.m[i]=a[i]);if(c)var h=c(s)}for(t&&t(n);l<r.length;l++)o=r[l],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(h)},n=self["webpackChunkthorviz"]=self["webpackChunkthorviz"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(2918)}));n=s.O(n)})();
//# sourceMappingURL=app.77987542.js.map